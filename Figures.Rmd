---
title: "DMI_ClinVar_AF"
author: "JesusAV"
date: "2025-01-16"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, message = F, warning = F)
```

```{r Packages, echo=F}
library(tidyverse)
library(gridExtra)
library(knitr) 
library(dplyr)
library(ggstats)
library(ggplot2)
library(ggvenn) 
library(ggbeeswarm)
library(ggVennDiagram)
library(corrplot)
library(colorspace)
library(igraph)
library(networkD3)
library(tools)
library(ggh4x)
library(scales)
library(cowplot)
```


```{r Palettes}
colors_Var <-c("#56B4E9","#E69F00","#d52221","#999999")
colors_BIN <- c("darkgrey","#006AB4")
colors_DMI <- c("darkgrey","#18974C")
colors_blues <- c("#CADCE8","#66A9D6","#4E93C1","#006AB4","#00548C")
colors_ELMtypes <- c("#734595","#A1BE1F","#F49E17","#3B6FB6","#D41645","#F4C61F")
colors_BRET <- c("grey40", "green", "magenta")
# https://www.datanovia.com/en/blog/awesome-list-of-657-r-color-names/
```

```{r Data_maps}
amino_acid_map <- c(
  Ala = "A", Arg = "R", Asn = "N", Asp = "D", 
  Cys = "C", Gln = "Q", Glu = "E", Gly = "G",
  His = "H", Ile = "I",  Leu = "L", Lys = "K", 
  Met = "M", Phe = "F", Pro = "P",  Ser = "S", 
  Thr = "T", Trp = "W", Tyr = "Y", Val = "V"
  )
 
elm_categories <- c("Cleavage", "Degrons","Subst. recog.", "Scaffolding", "PTM sites", "Localization")
strc_categories <- c("D. interface", "D. buried","D. surface", "M. interface", "M. not int.")
```


```{r Figure1_Data_Tables}
# Load all ClinVar variants
ClinVar_mutations <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/All_DMIs-All_mutations/DDD_and_clinvar_mutations_2023_release.csv", col_names = T)

# Reduce ClinVar table info to only unique protein variants
ClinVar_mutations <- ClinVar_mutations %>% select(uniprot_id, gene_symbol, aa_change, aa_pos, pathogenicity) %>% unique() # Keep columns with relevant information (excluding nucleotide information)
ClinVar_mutations$pathogenicity <- toTitleCase(ClinVar_mutations$pathogenicity) # Capitalize pathogenicity categories
ClinVar_mut_dis <-  ClinVar_mutations %>% rename(UniProt_ID = uniprot_id, Residue_n = aa_pos) %>% # Rename columns
  mutate(Residue= amino_acid_map[gsub("[0-9].*?$","",aa_change)] ) # Change variant format

# Load per residue protein disorder scores
Disorder_pLDDT <- read_tsv(file="/Volumes/imb-luckgr/imb-luckgr2/projects/AlphaFold/AFDB_HumanReferenceProteome/proteins_pLDDT_values_byResidue.txt", col_names = T)
Disorder_IUPred <- read_tsv(file="/Volumes/imb-luckgr/imb-luckgr2/projects/AlphaFold/AFDB_HumanReferenceProteome/CANO_ISO_SEQUENCES_IUPRed_LONG_disorder_byResidue.txt", col_names = T) %>% rename(UniProt_ID=ID, Residue_n=Residue_N)

# Combine ClinVar and disorder tables 
ClinVar_mut_dis <- left_join(ClinVar_mut_dis,Disorder_pLDDT,by=c("UniProt_ID","Residue","Residue_n"))
ClinVar_mut_dis <- left_join(ClinVar_mut_dis,Disorder_IUPred,by=c("UniProt_ID","Residue","Residue_n"))
rm(Disorder_pLDDT,Disorder_IUPred)

# Summarize disorder values for long proteins, which have values in different AFDB fragments
ClinVar_mut_dis <- ClinVar_mut_dis %>% group_by(UniProt_ID, gene_symbol, aa_change, Residue_n,pathogenicity,Residue ) %>% 
   summarise(avg_pLDDT = mean(pLDDT_value, na.rm=TRUE), avg_IUPred = mean(IUPred_long, na.rm=TRUE)) %>% ungroup()

#Disorder Thresholds
pLDDT_thrs <- 70 # as in AFDB includes Low and very Low # also by further reference listed at manuscript
IUPred_thrs <- 0.4 # as in Davey et al. 

# Use thresholds to categorise variants into Order and Disorder 
ClinVar_mut_dis <- ClinVar_mut_dis %>% 
  mutate(dis_pLDDT=case_when(avg_pLDDT < pLDDT_thrs ~ 1, avg_pLDDT >= pLDDT_thrs ~ 0  )) %>% # using pLDDT values
  mutate(dis_IUPred=case_when(avg_IUPred >= IUPred_thrs ~ 1, avg_IUPred < IUPred_thrs ~ 0 )) # using IUPred scores

```

```{r Figure1_Data_ChiSqr}
# Contingency tables for Order - Disorder enrichments across pathogenicities

# pLDDT contingency table
Pathogenicity_pLDDT_table <- ClinVar_mut_dis %>% filter(!is.na(dis_pLDDT)) %>% count(pathogenicity, dis_pLDDT) %>% 
  mutate(Category=case_when(dis_pLDDT==1 ~ "Disorder", dis_pLDDT==0 ~ "Order")) %>% select(-dis_pLDDT)  %>% pivot_wider(names_from = Category, values_from = n, values_fill=0 ) 

Pathogenicity_pLDDT_dt <- as.table(as.matrix(Pathogenicity_pLDDT_table[,2:3]))
rownames(Pathogenicity_pLDDT_dt) <-Pathogenicity_pLDDT_table$pathogenicity
Pathogenicity_pLDDT_chisq <- chisq.test(Pathogenicity_pLDDT_dt)

Pathogenicity_pLDDT_PU_dt <- Pathogenicity_pLDDT_dt[3:4,] # Only VUS and Pathogenic
Pathogenicity_pLDDT_PU_chisq <- chisq.test(Pathogenicity_pLDDT_PU_dt)

# UIPred contingency table
Pathogenicity_IUPred_table <- ClinVar_mut_dis %>% filter(!is.na(dis_IUPred)) %>% count(pathogenicity, dis_IUPred) %>% 
  mutate(Category=case_when(dis_IUPred==1 ~ "Disorder", dis_IUPred==0 ~ "Order")) %>% select(-dis_IUPred)  %>% pivot_wider(names_from = Category, values_from = n, values_fill=0 ) 

Pathogenicity_IUPred_dt <- as.table(as.matrix(Pathogenicity_IUPred_table[,2:3]))
rownames(Pathogenicity_IUPred_dt) <-Pathogenicity_IUPred_table$pathogenicity
Pathogenicity_IUPred_chisq <- chisq.test(Pathogenicity_IUPred_dt)

Pathogenicity_IUPred_PU_dt <- Pathogenicity_IUPred_dt[3:4,] # Only VUS and Pathogenic
Pathogenicity_IUPred_PU_chisq <- chisq.test(Pathogenicity_IUPred_PU_dt)

rm(Pathogenicity_pLDDT_table, Pathogenicity_IUPred_table)
```

```{r Figure1_SupData_AlphaMissense}
#The reference AM table should be extended to include all ClinVar proteins and not only the one from the DMI predictions
AM_ClinVar_proteins <- read_tsv(file="/Volumes/imb-luckgr/imb-luckgr2/projects/AlphaFold/AFDB_HumanReferenceProteome/AlphaMissense/Chunks/DMI_AM_Complete.tsv", col_names = F)

# Edit table 
colnames(AM_ClinVar_proteins) <- c("UniProt_ID", "AA_change","AM_value", "AM_pathogenicity")
AM_ClinVar_proteins <- AM_ClinVar_proteins %>% mutate(AM_pathogenicity=case_when(AM_pathogenicity=="benign" ~ "Benign",
                                                                                 AM_pathogenicity=="ambiguous" ~ "Ambiguous",
                                                                                 AM_pathogenicity=="pathogenic" ~ "Pathogenic" ))
#AM_ClinVar_proteins$AM_pathogenicity <- toTitleCase(AM_ClinVar_proteins$AM_pathogenicity) # Capitalize pathogenicity categories

# Combine AlphaMissense table with ClinVar one
ClinVar_mut_dis <- ClinVar_mut_dis %>% 
  mutate(R_variant=amino_acid_map[gsub("^.*?_","",gsub("[0-9]{1,5}","_",aa_change))] ) %>% 
  mutate(AA_change=paste(Residue,Residue_n,R_variant, sep="")) # Create/edit columns to be able to combine tables
ClinVar_mut_dis <- left_join(ClinVar_mut_dis, AM_ClinVar_proteins, by=c("UniProt_ID", "AA_change")) 
ClinVar_mut_dis$AM_pathogenicity <- ordered(ClinVar_mut_dis$AM_pathogenicity, levels = c("Benign","Ambiguous","Pathogenic"))

#write_tsv(ClinVar_mut_dis, file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/ClinVar_mutation_information.tsv")
```

```{r Figure1_Data_DMIs}
# Load all DMI predictions to get all ELM classes and types
All_DMIs <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/All_DMIs-All_mutations/HuRI_BioPlex_lit17_union.csv", show_col_types = F)
All_ELM_classes <- All_DMIs %>% select(Elm) %>% unique() %>% mutate(ELM_type=gsub("_.*?$","",Elm))
All_ELM_types <-  All_ELM_classes %>% count(ELM_type) # count for DMI predictor image
rm(All_DMIs, All_ELM_classes)

# Load only HuRI human ones
#HuRI_DMIs <- All_DMIs %>% filter(Source_HuRI=="1") %>% mutate(ELM_type=gsub("_.*?$","", Elm)) 
HuRI_DMIs <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/HuRI_DMIs-ClinVar_mutations/HuRI_human.csv", show_col_types = F)

# Filter HuRI DMI table to get scores
HuRI_DMI_scores <- HuRI_DMIs %>% select(intx_ID, SLiMProtein, Accession, SLiMMatch, DomainProtein, DomainID1, DomainMatch1, DMIMatchScore)

HuRI_DMI_scores %>% filter(DMIMatchScore >= 0.7) %>% nrow()
HuRI_DMI_scores %>% filter(DMIMatchScore >= 0.7) %>% select(intx_ID) %>% unique() %>% nrow()
(HuRI_DMI_scores %>% filter(DMIMatchScore >= 0.7) %>% nrow()) /( HuRI_DMI_scores %>% nrow())

HuRi_DMI %>% select(Accession) %>% unique()
```

```{r Figure1_Data_RRS4}
# Load all RRS4 data
RRS1_ROC <- read_tsv(file="/Volumes/imb-luckgr/projects/dmi_predictor/ML_items/RRS/RRSv1/RRSv1_avg_ROC_scores.txt", col_names = T, skip = 1)
RRS2_ROC <- read_tsv(file="/Volumes/imb-luckgr/projects/dmi_predictor/ML_items/RRS/RRSv2/RRSv2_avg_ROC_scores.txt", col_names = T, skip = 1)
RRS3_ROC <- read_tsv(file="/Volumes/imb-luckgr/projects/dmi_predictor/ML_items/RRS/RRSv3/RRSv3_avg_ROC_scores.txt", col_names = T, skip = 1)
RRS4_ROC <- read_tsv(file="/Volumes/imb-luckgr/projects/dmi_predictor/ML_items/RRS/RRSv4/RRSv4_avg_ROC_scores.txt", col_names = T, skip = 1)
RRS1_ROC$RRS <- "RRS1"
RRS2_ROC$RRS <- "RRS2"
RRS3_ROC$RRS <- "RRS3"
RRS4_ROC$RRS <- "RRS4"
RRS_ROC <- rbind(RRS4_ROC,rbind(RRS3_ROC,rbind(RRS1_ROC,RRS2_ROC)))
rm(RRS1_ROC,RRS2_ROC,RRS3_ROC,RRS4_ROC)

RRS1_PRC <- read_tsv(file="/Volumes/imb-luckgr/projects/dmi_predictor/ML_items/RRS/RRSv1/RRSv1_avg_PR_scores.txt", col_names = T, skip = 1)
RRS2_PRC <- read_tsv(file="/Volumes/imb-luckgr/projects/dmi_predictor/ML_items/RRS/RRSv2/RRSv2_avg_PR_scores.txt", col_names = T, skip = 1)
RRS3_PRC <- read_tsv(file="/Volumes/imb-luckgr/projects/dmi_predictor/ML_items/RRS/RRSv3/RRSv3_avg_PR_scores.txt", col_names = T, skip = 1)
RRS4_PRC <- read_tsv(file="/Volumes/imb-luckgr/projects/dmi_predictor/ML_items/RRS/RRSv4/RRSv4_avg_PR_scores.txt", col_names = T, skip = 1)
RRS1_PRC$RRS <- "RRS1"
RRS2_PRC$RRS <- "RRS2"
RRS3_PRC$RRS <- "RRS3"
RRS4_PRC$RRS <- "RRS4"
RRS_PRC <- rbind(RRS4_PRC,rbind(RRS3_PRC,rbind(RRS1_PRC,RRS2_PRC)))
rm(RRS1_PRC,RRS2_PRC,RRS3_PRC,RRS4_PRC)
```

```{r Figure1_Data_DMIscores}
# Count number of DMIs based on an increasing trheshold filter
DMIscores_count <- tibble(bin=seq(from = 0, to = 1, by = 0.05), count_dmi=0, count_ppi=0)

cc_v <- c() ## DMI count
pp_v <- c() ## PPI count

for(i in seq(from = 0, to = 1, by = 0.05)){
  cc <- HuRI_DMI_scores %>% filter(DMIMatchScore >= i) %>% nrow() #counting DMIs above a certain threshold
  pp <- HuRI_DMI_scores %>% filter(DMIMatchScore >= i) %>% select(intx_ID) %>% unique() %>% nrow() # counting the PPI of the previously filered DMIs
  cc_v <- c(cc_v, cc)
  pp_v <- c(pp_v, pp)
}

# Add counts to tibble
DMIscores_count$count_dmi <-cc_v 
DMIscores_count$count_ppi <-pp_v 

rm(HuRI_DMI_scores)
```

```{r Figure1_SuppData_ELMclasses}
# Load ELM instances and classes
elm_instances <- read_tsv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/ELM_Interacting_Regions_instances.tsv", col_names = T)

# Reduce instance table to only human ones and the necessary columns
elm_instances <- elm_instances %>% 
  filter(motif_protein_species=="Homo sapiens" & curators_instance_assessment=="true positive") %>% 
  select(ELM_Class, motif_protein_uniprot_accession, motif_start_residue_number, motif_end_residue_number, domain_protein_uniprot_accession)
elm_instances <-  elm_instances %>% 
  mutate(SLiMMatch=paste(motif_start_residue_number, motif_end_residue_number, sep="-")) %>%
  select(-motif_start_residue_number, -motif_end_residue_number) %>% mutate(ELM_instance = "1")
colnames(elm_instances)[c(1:3)] <- c("ELM_class", "SLiMProtein", "DomainProtein")

elm_instances %>% filter(ELM_class %in% HuRI_DMIs$ELM_class) %>% select(ELM_class) %>% unique() %>% nrow()
# 87 ELM classes from all 108 are also present in HuRI classes

DMI_ELM_instances <- HuRI_DMIs %>% filter(DMIMatchScore >= 0.7) %>% 
  select(intx_ID, SLiMProtein, Accession, ELM_class, SLiMMatch, DomainProtein, DomainID1, DomainName1, DomainMatch1, DMIMatchScore, ELM_type)

DMI_ELM_instances <- left_join(DMI_ELM_instances, elm_instances) 
DMI_ELM_instances <- DMI_ELM_instances %>% mutate(ELM_instance=case_when(is.na(ELM_instance) ~ "0", TRUE ~  ELM_instance))

elm_motifs <- elm_instances %>% select(ELM_class, SLiMProtein, SLiMMatch) %>% mutate(ELM_motif="1")
DMI_ELM_instances <- left_join(DMI_ELM_instances, elm_motifs)
rm(elm_motifs)
DMI_ELM_instances <- DMI_ELM_instances %>% mutate(ELM_motif=case_when(is.na(ELM_motif) ~ "0", TRUE ~  ELM_motif))
DMI_ELM_instances <- DMI_ELM_instances %>% unique()

DMI_ELM_instances %>% count(ELM_instance)
DMI_ELM_instances %>% count(ELM_motif)
DMI_ELM_instances %>% filter(ELM_instance=="1")

HURI_ELM_DMI_PPI_list <- list(CLV = HuRI_DMIs %>% filter(ELM_type=="CLV" & DMIMatchScore >=0.7 ) %>% select(intx_ID) %>% unique() %>% unlist(),
                              DEG = HuRI_DMIs %>% filter(ELM_type=="DEG" & DMIMatchScore >=0.7) %>% select(intx_ID) %>% unique() %>% unlist(), 
                              DOC = HuRI_DMIs %>% filter(ELM_type=="DOC" & DMIMatchScore >=0.7) %>% select(intx_ID) %>% unique() %>% unlist(), 
                              LIG = HuRI_DMIs %>% filter(ELM_type=="LIG" & DMIMatchScore >=0.7) %>% select(intx_ID) %>% unique() %>% unlist(), 
                              MOD = HuRI_DMIs %>% filter(ELM_type=="MOD" & DMIMatchScore >=0.7) %>% select(intx_ID) %>% unique() %>% unlist(), 
                              TRG = HuRI_DMIs %>% filter(ELM_type=="TRG" & DMIMatchScore >=0.7) %>% select(intx_ID) %>% unique() %>% unlist() ) 

DMI_ELM_classes <- HuRI_DMIs %>% filter(DMIMatchScore >= 0.7) %>% select(Accession, ELM_class, ELM_type) %>% unique()
```

```{r Figure1_SuppData_FeatureImportance}
features <- read_csv("/Users/jesusav/Desktop/Supp_tables/csv/DMI_ML_FeatureImportance.csv")
features <- features %>% select(Feature, Importance, RSS4)

feat_summary <- features %>% group_by(Feature) %>% 
  summarise(importance_mean=mean(Importance), importance_var=var(Importance), importance_sd=sd(Importance)) %>% ungroup()
feat_summary <-  feat_summary %>% mutate(Feature=gsub("_", " ", Feature))
```


```{r Figure1_Data_2}
# Load variants overlap on DMI fragments
HURI_ClinVar_mutation <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/HuRI_DMIs-ClinVar_mutations/DMI_human_HuRI_overlap_clinvar_2023_release.csv", show_col_types = F)

# Edit column values for plotting
HURI_ClinVar_mutation <- HURI_ClinVar_mutation %>% 
  mutate(fragment_type = toTitleCase(fragment_type)) %>%
  mutate(pathogenicity = toTitleCase(pathogenicity)) %>% 
  mutate(fragment_type=case_when(fragment_type=="Slim" ~ "Motif", TRUE ~ fragment_type))

# Define variant table only for motifs to add motif information
HURI_ClinVar_mut_motif <- HURI_ClinVar_mutation %>% 
  filter(fragment_type=="Motif") %>% 
  select(fragment_protein, fragment_id, fragment_pos, aa_change, pathogenicity) %>% 
  rename(Accession=fragment_id)
# Add ELM class information to DMI motif variants
HURI_ClinVar_mut_motif <- left_join(HURI_ClinVar_mut_motif, DMI_ELM_classes, by="Accession")

```

```{r Figure1_Data_ELM_pathogenic}
# Manual checks on pathogenic variants on DMI motif fragments

## Degrons
HURI_ClinVar_mut_motif %>% filter(ELM_type=="DEG" & pathogenicity=="Benign") %>% select(fragment_protein) #5 proteins from 3 degron classes
HURI_ClinVar_mut_motif %>% filter(ELM_type=="DEG" & pathogenicity=="Pathogenic" & Accession=="ELME000241")
# AFF4 (Q9UHB7) 252-260 DEG_SIAH_1 (Pro253Leu, Thr254Ala, Thr254Ser, Arg258Trp, Met260Val)

## Docking
HURI_ClinVar_mut_motif %>% filter(ELM_type=="DOC" & pathogenicity=="Pathogenic") 
# 6 motifs - 6 proteins
HuRI_DMIs %>% filter(SLiMProtein=="P84022" & ELM_class=="DOC_WW_Pin1_4" & SLiMMatch=="5-10") %>% select(DomainProtein) 
HuRI_DMIs %>% filter(SLiMProtein=="P84022" & ELM_class=="DOC_WW_Pin1_4" ) %>% select(SLiMMatch, DMIMatchScore) %>% unique()
HURI_ClinVar_mut_motif %>% filter(fragment_protein=="P84022" )
HuRI_DMIs %>% filter(SLiMProtein=="O95817" & ELM_class=="DOC_MAPK_MEF2A_6") %>% select(DomainProtein) 

## Ligand
HURI_ClinVar_mut_motif %>% filter(ELM_type=="LIG" & pathogenicity=="Pathogenic") 
# 6 motifs - 6 proteins

## Modification
HURI_ClinVar_mut_motif %>% filter(ELM_type=="MOD" & pathogenicity=="Pathogenic") 
MOD_prot_path <- HURI_ClinVar_mut_motif %>% filter(ELM_type=="MOD" & pathogenicity=="Pathogenic") %>% select(fragment_protein,Accession) %>% unique() 
HURI_ClinVar_mutation %>% filter(fragment_type=="Motif" & pathogenicity=="Pathogenic" & fragment_id %in% MOD_prot_path$Accession) %>% group_by(fragment_protein) 
# 2 motifs - 2 proteins

## Targetting
HURI_ClinVar_mut_motif %>% filter(ELM_type=="TRG" & pathogenicity=="Pathogenic" & Accession=="ELME000120") %>% group_by(fragment_protein) 
#HuRi_DMI %>% filter(Accession=="ELME000512" & SLiMProtein=="P30279")
HuRI_DMIs %>% filter( SLiMProtein=="Q8N0S2")

HuRI_DMIs %>% filter(DMIMatchScore>=0.7 & SLiMProtein=="Q9UHB7" & ELM_class=="DEG_SIAH_1" & SLiMMatch=="252-260") %>% select(DomainName1) %>% unique()
HuRI_DMIs %>% filter(DMIMatchScore>=0.7 & SLiMProtein=="P40763" & ELM_class=="LIG_SH2_STAT5" & SLiMMatch=="705-708") %>% select(DomainName1) %>% unique()
HuRI_DMIs %>% filter(DMIMatchScore>=0.7 & SLiMProtein=="P98174" & ELM_class=="LIG_SH3_1" & SLiMMatch=="186-192") %>% select(DomainName1) %>% unique()
HuRI_DMIs %>% filter(DMIMatchScore>=0.7 & SLiMProtein=="Q8WWZ3" & ELM_class=="LIG_TRAF6" & SLiMMatch=="25-33") %>% select(DomainName1) %>% unique()


```

```{r Figure1_Data2}
HuRi_DMI <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/HuRI_DMIs-ClinVar_mutations/HuRI_human_highScores.csv")
HuRi_DMI <- HuRi_DMI %>% filter(DMIMatchScore>=0.7)

```

```{r Figure1_Data2_DMI_VariantCount}
## Define table of DMI with proteins with ClinVar mutations
HURI_ClinVar_DMI <- HuRi_DMI %>% 
  filter(SLiMProtein %in% HURI_ClinVar_mutation$fragment_protein | DomainProtein %in% HURI_ClinVar_mutation$fragment_protein)

# Count of variants of different pathogenicity per fragment 
HURI_ClinVar_mutation_count_DMI <- HURI_ClinVar_mutation %>% 
  count(fragment_protein, fragment_id, fragment_pos, pathogenicity) %>% 
  pivot_wider(names_from = pathogenicity, values_from = n, values_fill = 0)

# HuRI DMIs that have ClinVar variants
## Select minimal information 
HURI_ClinVar_DMI_mut_count_DMI <- HURI_ClinVar_DMI %>% 
  select(intx_ID, DomainProtein, DomainID1, DomainMatch1, SLiMProtein, Accession, SLiMMatch) %>% 
  rename(fragment_protein=SLiMProtein, fragment_id=Accession, fragment_pos=SLiMMatch)

## Combine with mutation counts for motifs
HURI_ClinVar_DMI_mut_count_DMI <- left_join(HURI_ClinVar_DMI_mut_count_DMI, 
                                            HURI_ClinVar_mutation_count_DMI, 
                                            by=c("fragment_protein", "fragment_id", "fragment_pos")) %>% 
  mutate_if(is.numeric,coalesce,0) %>% 
  rename(SLiMProtein=fragment_protein, Accession=fragment_id, SLiMMatch=fragment_pos) %>% 
  rename(fragment_protein=DomainProtein, fragment_id=DomainID1, fragment_pos=DomainMatch1)
## Combine with mutation counts for domains
HURI_ClinVar_DMI_mut_count_DMI <- left_join(HURI_ClinVar_DMI_mut_count_DMI, 
                                            HURI_ClinVar_mutation_count_DMI, 
                                            by=c("fragment_protein", "fragment_id", "fragment_pos")) %>% 
  rename(DomainProtein=fragment_protein, DomainID1=fragment_id, DomainMatch1=fragment_pos)

## Avoid counting twice when there are homotypic interactions
HURI_ClinVar_DMI_mut_count_DMI <- HURI_ClinVar_DMI_mut_count_DMI %>% 
  mutate(Benign = Benign.x + Benign.y) %>%
  mutate(Uncertain = Uncertain.x + Uncertain.y) %>%
  mutate(Conflicting = Conflicting.x + Conflicting.y) %>%
  mutate(Pathogenic = Pathogenic.x + Pathogenic.y)

# Expand to count table with column for pathogenicity and mutation count
HURI_ClinVar_DMI_mut_count_DMI_long <- HURI_ClinVar_DMI_mut_count_DMI %>% 
  select(intx_ID, DomainProtein, DomainID1, DomainMatch1, SLiMProtein, Accession, SLiMMatch, Benign, Conflicting, Pathogenic, Uncertain) %>% 
  pivot_longer(names_to = "pathogenicity", cols = Benign:Uncertain) %>% 
  filter(value>0) %>% unique()

# Number of DMIs with variants and their corresponding PPIs 
HURI_ClinVar_DMI_mut_count_DMI_long %>% select(-pathogenicity, -value) %>% unique() #10,238
HURI_ClinVar_DMI_mut_count_DMI_long %>% select(intx_ID) %>% unique() # 2,624

HURI_ClinVar_DMI_mut_count_DMI_long %>% filter(pathogenicity=="Uncertain" | pathogenicity=="Pathogenic") %>% select(-pathogenicity, -value) %>% unique()

```

```{r Figure1_Data_Mutations_fragment_tables}
Fragment_contingency_tb <- data.frame(motif=c(0,0,0,0),
                                  domain=c(0,0,0,0),
                                  other=c(0,0,0,0),
                                  total=c(0,0,0,0))
rownames(Fragment_contingency_tb) <- c(" benign", "conflicting", "pathogenic", "uncertain")

Fragment_contingency_tb$motif <- HURI_ClinVar_mutation %>% filter(fragment_type=="Motif") %>% select(pathogenicity) %>% table() %>% as.vector()
Fragment_contingency_tb$domain <- HURI_ClinVar_mutation %>% filter(fragment_type=="Domain") %>% select(pathogenicity) %>% table() %>% as.vector()

DMI_proteins <- HURI_ClinVar_mutation %>% select(fragment_protein) %>% unique() %>% unlist()
Fragment_contingency_tb$total <- ClinVar_mutations %>% filter(uniprot_id %in% DMI_proteins) %>% select(pathogenicity) %>% table() %>% as.vector()
Fragment_contingency_tb$other <- Fragment_contingency_tb$total - Fragment_contingency_tb$motif - Fragment_contingency_tb$domain
Fragment_contingency_tb


Motif_simple_tb <- as.data.frame(Fragment_contingency_tb[c(1,3),1])
colnames(Motif_simple_tb) <- "motif"
Motif_simple_tb$non_motif <- unlist(Fragment_contingency_tb[c(1,3),2] + Fragment_contingency_tb[c(1,3),3])
row.names(Motif_simple_tb) <- c("benign", "pathogenic")
Motif_simple_tb

Domain_simple_tb <- as.data.frame(Fragment_contingency_tb[c(1,3),2])
colnames(Domain_simple_tb) <- "domain"
Domain_simple_tb$non_domain <- unlist(Fragment_contingency_tb[c(1,3),1] + Fragment_contingency_tb[c(1,3),3])
row.names(Domain_simple_tb) <- c("benign", "pathogenic")
Domain_simple_tb

Fragment_contingency_dt <- as.table(as.matrix(Fragment_contingency_tb[,1:3]))
Fragment_contingency_chisq <- chisq.test(Fragment_contingency_dt)
```


```{r Figure2_data_BRET}
BRET_results <- read_tsv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/BRET_experiments/titration_cat_scoring_v6_with_include.tsv")
BRET_results <- BRET_results %>% mutate(mut_type=case_when(mCit_plasmid=="pcDNA3.1 mCit-His3C-MYD88_134_138del" ~ "Motif validation", TRUE ~ mut_type))
BRET_results <- BRET_results %>% 
  mutate(include=case_when(NL_plasmid=="pcDNA3.1 cmyc-NL-IQCB1_N273Y" &  mCit_symbol=="MNS1" & project_id=="Lu153r01" ~ "1",
                           NL_plasmid=="pcDNA3.1 cmyc-NL-SPOP_S119L" &  mCit_symbol=="MYD88" & project_id=="Lu171r01" ~ "0",
                           NL_plasmid=="pcDNA3.1 cmyc-NL-SPOP_R70T" &  mCit_symbol=="RXRB" & project_id=="Lu169r01" ~ "0" , TRUE ~ include))
BRET_results <- BRET_results %>% filter(include=="1")
BRET_results <- BRET_results %>% mutate(exp_category=case_when(mut_type=="Domain validation" | mut_type=="Motif validation" ~ "interface", TRUE ~ "variant"))

#Significance labels
BRET_results <- BRET_results %>%  
  mutate(tstat_bret50 = as.double(gsub("\\,","\\.",tstat_bret50)) ) %>% mutate(tstat_cBRET = as.double(gsub("\\,","\\.",tstat_cBRET)) ) %>% 
  mutate(pval_bret50 = as.double(gsub("\\,","\\.",pval_bret50)) ) %>% mutate(pval_cBRET = as.double(gsub("\\,","\\.",pval_cBRET)) ) %>% 
  mutate(sig_BRET50=case_when(pval_bret50>0.05 ~ "",  pval_bret50 <= 0.05 & pval_bret50>0.01 ~ "*", pval_bret50 <= 0.01 & pval_bret50>0.001 ~ "**",pval_bret50 <=  0.001 ~ "***")) %>%
  mutate(sig_maxBRET=case_when(pval_cBRET>0.05 ~ "",  pval_cBRET <= 0.05 & pval_cBRET>0.01 ~ "*", pval_cBRET <= 0.01 & pval_cBRET>0.001 ~ "**",pval_cBRET <=  0.001 ~ "***"))

BRET_results <- BRET_results %>% mutate(BRET_category=case_when(num_use_fit_WT==3 & num_use_fit_MUT==3 ~ "BRET50", 
                                                                num_repl_include_MUT==3 & num_repl_include_MUT==3 ~ "maxBRET",
                                                                TRUE ~ "other"))

mutant_descriptions <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/BRET_experiments/mutant_description.csv")
mutant_descriptions <- mutant_descriptions %>% select(-template_plasmid_name, -description, -success, -alpha_missense_pred)


### Domain validation data
domain_BRET_categories <- BRET_results %>% select(mCit_symbol) %>% unique()
domain_BRET_categories$category <- as.factor(c("candidate", "positive", "negative", 
                                     "positive", "candidate", "negative",
                                     "candidate","negative",
                                     "positive", "candidate",
                                     "candidate", "candidate","positive","negative","negative"))


domain_BRET <- BRET_results %>% filter(mut_type=="Domain validation") %>% 
  mutate(mutant=gsub("^pc.*?NL-", "", NL_plasmid)) %>% # Mutant labels
  mutate(residue=as.numeric(gsub("[A-Z]", "", gsub("^.*?_", "", mutant)))) %>% # Mutant index
  mutate(tstat_bret50=case_when(tstat_bret50 < -20 ~ -20, tstat_bret50 > 20 ~ 20, TRUE ~ tstat_bret50), 
         tstat_cBRET=case_when(tstat_cBRET < -20 ~ -20, tstat_cBRET > 20 ~ 20, TRUE ~ tstat_cBRET)) # Capping values
domain_BRET <- domain_BRET %>% select(mCit_plasmid,NL_symbol, mCit_symbol, pval_bret50, tstat_bret50, pval_cBRET, tstat_cBRET, sig_BRET50, sig_maxBRET, BRET_category, mutant, residue)
domain_BRET <- left_join(domain_BRET, domain_BRET_categories)
domain_BRET$category <- factor(domain_BRET$category, levels=c("negative", "positive", "candidate"))
domain_BRET <- domain_BRET  %>% mutate(mutant=case_when(mutant=="IQCB1" ~ gsub("pcDNA3.1 mCit-His3C-","",mCit_plasmid), TRUE~ mutant))%>% 
  separate(mutant, c("gene_symbol","mutation"), sep="_", remove=F)
domain_BRET <- left_join(domain_BRET, mutant_descriptions)


### Motif validation data
motif_BRET <- BRET_results %>% filter(mut_type=="Motif validation") %>% 
  mutate(mutant=gsub("^pc.*?His3C-", "", mCit_plasmid)) %>%  # Mutant labels
  mutate(residue=as.numeric(gsub("[A-Z]", "", gsub("_.*?$", "",gsub("^.*?_", "", mutant))))) %>% # Mutant index
  mutate(tstat_bret50=case_when(tstat_bret50 < -20 ~ -20, tstat_bret50 > 20 ~ 20, TRUE ~ tstat_bret50), 
         tstat_cBRET=case_when(tstat_cBRET < -20 ~ -20, tstat_cBRET > 20 ~ 20, TRUE ~ tstat_cBRET)) # Capping values
motif_BRET <- motif_BRET %>% select(NL_plasmid, NL_symbol, mCit_symbol, pval_bret50, tstat_bret50, pval_cBRET, tstat_cBRET, sig_BRET50, sig_maxBRET, BRET_category, mutant, residue)
motif_BRET <- left_join(motif_BRET, domain_BRET_categories)
motif_BRET$category <- factor(motif_BRET$category, levels=c("negative", "positive", "candidate"))

motif_BRET <- motif_BRET  %>% mutate(mutant=case_when(NL_symbol=="IQCB1" ~ gsub("pcDNA3.1 cmyc-NL-","",NL_plasmid), TRUE~ mutant))%>% 
  mutate(mutant=gsub("(^.*?_[0-9]{1,3})_","\\1-",mutant)) %>% separate(mutant, c("gene_symbol","mutation"), sep="_", remove=F)
motif_BRET <- left_join(motif_BRET, mutant_descriptions %>% mutate(mutation=gsub("_","-",mutation), canonical_mutation=gsub("_","-",canonical_mutation)))
motif_BRET <- motif_BRET %>% mutate(canonical_mutation=case_when(mutant=="MYD88_134-138del" ~ "134-138del", TRUE ~ canonical_mutation), uniprot_id
=case_when(mutant=="MYD88_134-138del" ~ "Q99836", TRUE ~ uniprot_id))

### Mutants testing data
mutants_BRET <- BRET_results %>% filter(exp_category=="variant") %>% 
  mutate(domain_variant=str_detect(NL_plasmid, "_[A-Z][0-9]{1,4}[A-Z]"), motif_variant=str_detect(mCit_plasmid, "_[A-Z][0-9]{1,4}[A-Z]")) %>% # mutant labels
  mutate(mutant=case_when(domain_variant==TRUE ~ gsub("^pc.*?NL-", "", NL_plasmid), 
                          motif_variant==TRUE ~ gsub("^pc.*?His3C-", "", mCit_plasmid) )) %>% 
  mutate(mutant=case_when(domain_variant==TRUE ~ gsub("_", " ",mutant), motif_variant==TRUE ~ gsub("_", " ",mutant))) %>% 
  mutate(residue=as.numeric(gsub("[A-Z]", "", gsub("^.*? ", "", mutant)))) %>% # Mutant index
  mutate(tstat_bret50=case_when(tstat_bret50 < -20 ~ -20, tstat_bret50 > 20 ~ 20, TRUE ~ tstat_bret50), 
         tstat_cBRET=case_when(tstat_cBRET < -20 ~ -20, tstat_cBRET > 20 ~ 20, TRUE ~ tstat_cBRET)) # Capping values
mutants_BRET <- mutants_BRET %>% select(NL_plasmid, mCit_plasmid,NL_symbol, mCit_symbol, pval_bret50, tstat_bret50, pval_cBRET, tstat_cBRET, sig_BRET50, sig_maxBRET, BRET_category, motif_variant, domain_variant, mutant, residue)

mutants_BRET_categories <- mutants_BRET %>% select(mutant) %>% unique()

BRET_mutants <- read_tsv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/BRET_experiments/tested_disease_mutations_structure_computations_extended.txt")
Clinvar_mutants <- BRET_mutants %>% 
  mutate(mutant=case_when(mutation_location=="domain" ~ paste(domain_partner,aa_change, sep=" "), 
                                                            TRUE ~ paste(motif_partner,aa_change, sep=" "))) %>%
  select(mutant, ClinVar) %>% unique()
mutants_BRET_categories <- left_join(mutants_BRET_categories, Clinvar_mutants)
mutants_BRET <- left_join(mutants_BRET, mutants_BRET_categories)
mutants_BRET <- left_join(mutants_BRET, domain_BRET_categories)
mutants_BRET$category <- factor(mutants_BRET$category, levels=c("negative", "positive", "candidate"))
mutants_BRET <- mutants_BRET %>% mutate(ClinVar=case_when(mutant=="IKZF1 S41L" ~ "Uncertain", 
                                          mutant=="SPOP Y87C" ~ "Uncertain", TRUE ~ ClinVar))
mutants_BRET <- mutants_BRET %>% separate(mutant, c("gene_symbol","mutation"), sep=" ", remove=F)
mutants_BRET <- left_join(mutants_BRET, mutant_descriptions)



#CALM1 D94H
BRET_results %>% filter(NL_symbol=="CTBP1" & mCit_symbol=="DMRTB1") %>% arrange(project_id) %>% select(NL_plasmid, mCit_plasmid, tstat_bret50, tstat_cBRET, sig_BRET50, sig_maxBRET)

BRET_results %>% filter(NL_symbol=="SPOP" &  mCit_symbol=="MYD88" ) %>% select(NL_plasmid, mCit_plasmid, project_id, include)

domain_BRET %>% filter(mutant=="CTBP1_C27E")

motif_BRET %>% select(mutant) %>% unique() 
motif_BRET %>% filter(NL_plasmid=="") %>% unique() 
```

```{r Figure2_data_titration}
BRET_selection <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/BRET_experiments/titrations_filtering.csv")
BRET_selection <- BRET_selection %>% filter(include==1 & use_fit==1) %>% select(-include, -use_fit, -comment)
BRET_selection$repl_id <- as.character(BRET_selection$repl_id)

BRET_plasmid_layout <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/BRET_experiments/plate_layout.csv")
BRET_plasmid_info <- BRET_plasmid_layout %>% 
  select(project_id, repl_id, NL_plasmid, mCit_plasmid, NL_plasmid_id, mCit_plasmid_id) %>% unique() %>%
  filter(NL_plasmid!="empty" & mCit_plasmid!="empty")
BRET_plasmid_info <- BRET_plasmid_info %>% filter(project_id %in% BRET_selection$project_id)


BRET_values <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/BRET_experiments/titration_values.csv")
BRET_values$ratio <- BRET_values$fluo / BRET_values$lumi
BRET_values$repl_id <- as.character(BRET_values$repl_id)

BRET_values_info <- left_join(BRET_values,BRET_plasmid_info)
BRET_values_info <- BRET_values_info %>% mutate(NL_construct= gsub("pcDNA3.1 cmyc-NL-", "", NL_plasmid),
                                                          mCit_construct = gsub("pcDNA3.1 mCit-His3C-", "", mCit_plasmid))
BRET_values_info <- BRET_values_info %>% separate(NL_construct, c("NL_protein","NL_mutation"), sep="_", remove=F) %>% 
  mutate(NL_mutation=case_when(is.na(NL_mutation) ~ NA, !is.na(NL_mutation) ~ gsub("^.*?_", "", NL_construct) )) %>% 
  separate(mCit_construct, c("mCit_protein","mCit_mutation"), sep="_", remove=F) %>% 
  mutate(mCit_mutation=case_when(is.na(mCit_mutation) ~ NA, !is.na(mCit_mutation) ~ gsub("^.*?_", "", mCit_construct) )) %>% 
  mutate(test=case_when(is.na(NL_mutation) & is.na(mCit_mutation) ~ "WT", TRUE ~ "mutant"))


BRET_fits <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/BRET_experiments/titration_fit.csv")

BRET_selection_values <- left_join(BRET_selection, BRET_values_info)
BRET_mutant_pairs <- BRET_selection_values %>% filter(test=="mutant") %>% select(project_id, NL_plasmid_id, mCit_plasmid_id) %>% unique()

BRET_selection_values <- left_join(BRET_selection, BRET_values_info)

BRET_mutant_pairs <- BRET_results %>% select(project_id, NL_plasmid_id, mCit_plasmid_id,BRET_category) %>% unique()
BRET_mutant_pairs <- left_join(BRET_mutant_pairs, BRET_values_info %>% select(project_id, NL_plasmid_id, mCit_plasmid_id,NL_construct, mCit_construct, NL_protein, mCit_protein, test)) %>% unique()

BRET_mutant_pairs <- BRET_mutant_pairs %>% 
  mutate(gene_symbol=case_when(NL_construct==NL_protein ~ mCit_protein, mCit_construct==mCit_protein ~ NL_protein)) %>%
  mutate(mutation=case_when(NL_construct==NL_protein ~ mCit_construct, mCit_construct==mCit_protein ~ NL_construct)) %>%
  mutate(mutation=gsub("-", "_",gsub("^.*?_", "",gsub("_([0-9]{1,3}del)", "-\\1",mutation ))))
BRET_mutant_pairs <- left_join(BRET_mutant_pairs, mutant_descriptions  %>% mutate(canonical_mutation=gsub("-","_",canonical_mutation)))


BRET_mutant_pairs <- BRET_mutant_pairs %>% 
  mutate(mCit_construct=case_when(NL_construct==NL_protein ~ paste(gene_symbol,canonical_mutation,sep="_"), TRUE ~ mCit_construct),
         NL_construct=case_when(mCit_construct==mCit_protein ~ paste(gene_symbol,canonical_mutation,sep="_"), TRUE ~ NL_construct))
```


```{r Figure3_data1}
BRET_mutants <- read_tsv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/BRET_experiments/tested_disease_mutations_structure_computations_extended.txt")

BRET_mutants <- BRET_mutants %>% mutate(AlphaMissense=case_when(AlphaMissense=="likely pathogenic"  ~ "Pathogenic",
                                                                AlphaMissense=="uncertain"  ~ "Ambiguos",
                                                                AlphaMissense=="likely benign"  ~ "Benign", TRUE ~ AlphaMissense))

BRET_mutants <- BRET_mutants %>% mutate(Fragment=case_when(mutation_location=="domain"  ~ "Domain",
                                                                mutation_location=="outside motif" |  mutation_location=="core motif" ~ "Motif"))

BRET_mutants <- BRET_mutants %>% mutate(interface = case_when(pLDDT >= 80 & deltaRSA<(-0.05)  ~ "interface",
                                                                TRUE ~ "not_interface"))  %>% 
  mutate(structural_region = case_when(Fragment=="Domain" & interface == "interface"  ~ "d_interface",
                                       Fragment=="Domain" & interface == "not_interface" & RSA>0.25 ~ "d_surface",
                                       Fragment=="Domain" & interface == "not_interface" & RSA<=0.25 ~ "d_buried",
                                       Fragment=="Motif" & interface == "interface" ~ "m_interface",
                                       Fragment=="Motif" & interface == "not_interface" ~ "m_n_interface",
                                       TRUE ~ "other" ) )

BRET_mutants$structural_region <- ordered(BRET_mutants$structural_region, levels = c("d_interface", "d_buried","d_surface", "m_interface","m_n_interface"))  
BRET_mutants$AlphaMissense <- ordered(BRET_mutants$AlphaMissense, levels = c("Benign", "Ambiguos","Pathogenic")) 

BRET_mutants <- BRET_mutants %>% filter(!(motif_partner=="LITAF" & (aa_change=="P58L" |aa_change=="P59R" |aa_change=="Y61C"  )))

BRET_mutants_motif <-  BRET_mutants %>% filter(mutation_location!="domain") %>% mutate(mutation_location=case_when(mutation_location=="core motif" ~ "Core",
                                                                                                                   mutation_location=="outside motif" ~ "Flank"))
BRET_mutants %>% filter(structural_region=="d_interface")

BRET_mutants %>% filter(structural_region=="d_surface")

#BRET_mutants_update <- mutants_BRET %>% mutate(exp_conclusion=case_when(pval_bret50 <= 0.05 | pval_cBRET <= 0.05 ~ "disrupting", TRUE ~ "not_disrupting")) %>%
#  mutate(fragment_variant=case_when(motif_variant==TRUE ~ "motif", domain_variant==TRUE ~ "domain")) %>%
#  select(-NL_plasmid, -mCit_plasmid, -motif_variant, -domain_variant) %>% separate(mutant, c("mut_protein", "aa_change"), sep=" ")
  
#write_tsv(BRET_mutants_update, file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/BRET_experiments/tested_disease_mutations_structure_computations_extended_2.tsv")

BRET_mutants_update <- read_tsv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/BRET_experiments/tested_disease_mutations_structure_computations_extended_2.tsv")

BRET_mutants_update <- BRET_mutants_update %>% mutate(AlphaMissense=case_when(AlphaMissense=="likely pathogenic"  ~ "Pathogenic",
                                                                AlphaMissense=="uncertain"  ~ "Ambiguos",
                                                                AlphaMissense=="likely benign"  ~ "Benign", TRUE ~ AlphaMissense))

BRET_mutants_update <- BRET_mutants_update %>% mutate(Fragment=case_when(mutation_location=="domain"  ~ "Domain",
                                                                mutation_location=="outside motif" |  mutation_location=="core motif" ~ "Motif"))

BRET_mutants_update <- BRET_mutants_update %>% mutate(interface = case_when(pLDDT >= 80 & deltaRSA<(-0.05)  ~ "interface", TRUE ~ "not_interface"))  %>% 
  mutate(interface = case_when( mutation_location=="outside motif" ~ "not_interface", TRUE ~ interface)) %>% 
  mutate(structural_region = case_when(Fragment=="Domain" & interface == "interface"  ~ "d_interface",
                                       Fragment=="Domain" & interface == "not_interface" & RSA>0.25 ~ "d_surface",
                                       Fragment=="Domain" & interface == "not_interface" & RSA<=0.25 ~ "d_buried",
                                       Fragment=="Motif" & interface == "interface" ~ "m_interface",
                                       Fragment=="Motif" & interface == "not_interface" ~ "m_n_interface",
                                       TRUE ~ "other" ) )

BRET_mutants_update$structural_region <- ordered(BRET_mutants_update$structural_region, levels = c("d_interface", "d_buried","d_surface", "m_interface","m_n_interface"))  
BRET_mutants_update$AlphaMissense <- ordered(BRET_mutants_update$AlphaMissense, levels = c("Benign", "Ambiguos","Pathogenic")) 
BRET_mutants_update_motif <-  BRET_mutants_update %>% filter(mutation_location!="domain") %>%
  mutate(mutation_location=case_when(mutation_location=="core motif" ~ "Core", mutation_location=="outside motif" ~ "Flank"))

BRET_mutants_update %>% filter(mCit_symbol=="RXRB")
```


```{r Figure4_data1}
### Thresholds
thrs_m_conf <- 0.6
thrs_m_pLDDT <- 80
thrs_m_delt_RSA <- -0.05
thrs_m_RSA <- 0.25

DMI_AF_metrics <- read_csv(file="/Volumes/imb-luckgr/imb-luckgr2/projects/AlphaFold/HuRI_DMI_AF_modelling/Score_files/DMI_AF_model_metrics.csv")
#Q08209_SM00156_O_10_373.Q96KS9_ELME000237_D_3_9 DOC
#Q08999_PF01857_O_830_1030.Q99708_ELME000007_D_152_169 LIG
DMI_AF_metrics <- DMI_AF_metrics %>% mutate(ELM_type=case_when(DMI_model=="Q08209_SM00156_O_10_373.Q96KS9_ELME000237_D_3_9" ~ "DOC",
                                                               DMI_model=="Q08999_PF01857_O_830_1030.Q99708_ELME000007_D_152_169" ~ "LIG",
                                                               TRUE ~ ELM_type))

DMI_AF_class_table <- DMI_AF_metrics  %>% filter(model_score>=thrs_m_conf) %>% select(intx_ID, ELM_type) %>% unique()

DMI_AF_metrics %>% filter(model_score>=thrs_m_conf) %>% nrow()
DMIs_hq <- DMI_AF_metrics %>% filter(model_score>=thrs_m_conf) %>% select(DMI_model) %>% unlist()

DMI_AF_mutations <- read_tsv(file="/Volumes/imb-luckgr/imb-luckgr2/projects/AlphaFold/HuRI_DMI_AF_modelling/Score_files/DMI_AF_model_metrics_mappedMutations.tsv")
DMI_AF_mut_hq <- DMI_AF_mutations %>% filter(DMI %in% DMIs_hq)
DMI_AF_mut_hq <- DMI_AF_mut_hq %>% 
  mutate(interface = case_when(pLDDT >= thrs_m_pLDDT & Acc_change<(thrs_m_delt_RSA)  ~ "interface",
                               TRUE ~ "not_interface"))  %>% 
  mutate(structural_region = case_when(Fragment=="Domain" & interface == "interface"  ~ "d_interface",
                                       Fragment=="Domain" & interface == "not_interface" & Norm_Acc>thrs_m_RSA ~ "d_surface",
                                       Fragment=="Domain" & interface == "not_interface" & Norm_Acc<=thrs_m_RSA ~ "d_buried",
                                       Fragment=="Motif"  & interface == "interface"  ~ "m_interface",
                                       Fragment=="Motif"  & interface == "not_interface" ~ "m_non_interface",
                                       TRUE ~ "other" ) )

structural_region <- c("d_interface", "d_buried", "d_surface","m_interface", "m_non_interface")
DMI_AF_mut_hq$structural_region <- ordered(DMI_AF_mut_hq$structural_region, levels = structural_region)
DMI_AF_mut_hq$AM_pathogenicity <- ordered(DMI_AF_mut_hq$AM_pathogenicity, levels = c("AM_benign","AM_ambiguous","AM_pathogenic"))

DMI_AF_mut_hq$Pathogenicity <- toTitleCase(DMI_AF_mut_hq$Pathogenicity)

#write_tsv(DMI_AF_mut_hq, file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/DMI_AF_mutation_information.tsv")

DMI_AF_mut_hq_table <- DMI_AF_mut_hq %>% filter(structural_region!="other") %>% count(Pathogenicity, structural_region) %>% pivot_wider(names_from = structural_region, values_from = n, values_fill=0 )

DMI_AF_mut_hq_dt <- as.table(as.matrix(DMI_AF_mut_hq_table[,2:6]))
rownames(DMI_AF_mut_hq_dt) <-DMI_AF_mut_hq_table$Pathogenicity
DMI_AF_mut_hq_chisq <- chisq.test(DMI_AF_mut_hq_dt)
DMI_AF_mut_hq_chisq

DMI_AF_mut_hq_PU_dt <- DMI_AF_mut_hq_dt[3:4,]
DMI_AF_mut_hq_PU_chisq <- chisq.test(DMI_AF_mut_hq_PU_dt)
DMI_AF_mut_hq_PU_chisq


DMI_AF_mut_interfacial_dt <- as.table(as.matrix(DMI_AF_mut_hq_table[,c(2,5)]))
rownames(DMI_AF_mut_interfacial_dt) <- as.vector(DMI_AF_mut_hq_table$Pathogenicity)
DMI_AF_mut_interfacial_chisq <- chisq.test(DMI_AF_mut_interfacial_dt)
DMI_AF_mut_interfacial_chisq


DMI_AF_metrics %>% filter(intx_ID=="Q16630_Q9NZC7") %>% select(model_score)
```

```{r Figure4_data2}
Model_metrics  <- read_tsv(file="/Volumes/imb-luckgr/imb-luckgr2/projects/AlphaFold/HuRI_DMI_AF_modelling/All_model_metrics.tsv")

Model_metrics_fragments <- read_tsv(file="/Volumes/imb-luckgr/imb-luckgr2/projects/AlphaFold/HuRI_DMI_AF_modelling/All_model_metrics_byFragments.tsv")
Model_metrics_fragments <- Model_metrics_fragments %>% filter(model_score>=0.6)

Model_metrics_motif <- Model_metrics %>% filter(Fragment=="Motif" & model_score>=0.6) %>% select(DMI, aa_code, residue_n, motif_start, pLDDT, Contact_3A, Contact_5A, SC_total_Acc, SC_norm_Acc, Acc_change)

Model_metrics_motif <-  Model_metrics_motif %>% rename(fragment_start=motif_start)
Model_metrics_motif$motif_start <- as.double(gsub("_.*?$","",gsub("^.*?_D_","",Model_metrics_motif$DMI)))
Model_metrics_motif$motif_end <- as.double(gsub("^.*?_","",gsub("^.*?_D_","",Model_metrics_motif$DMI)))
Model_metrics_motif$motif_len <- Model_metrics_motif$motif_end - Model_metrics_motif$motif_start
Model_metrics_motif <- Model_metrics_motif %>% mutate(Motif_region = case_when( residue_n < motif_start~ "Up",
                                                                                residue_n > motif_end~ "Down",
                                                                                TRUE  ~ "Core"))

Model_metrics_motif$Motif_region <- ordered(Model_metrics_motif$Motif_region, levels = c("Up", "Core","Down"))  
Model_metrics_motif$Motif_accession <- gsub("_D_.*?$","",gsub("^.*?_ELM","ELM",Model_metrics_motif$DMI))

ELM_classes <- HuRI_DMIs %>% select(Accession, ELM_class, ELM_type) %>% unique() %>% rename(Motif_accession=Accession)

Model_metrics_motif <- left_join(Model_metrics_motif, ELM_classes, by="Motif_accession")

Model_metrics_motif <- Model_metrics_motif %>% mutate(Motif_flanks = case_when( residue_n < motif_start ~ residue_n - motif_start,
                                                                                residue_n > motif_end ~ residue_n - motif_end,
                                                                                TRUE  ~ 0 ))

Model_metrics_motif %>% filter(Motif_flanks < -5 | Motif_flanks >= 5) %>% select(DMI) %>% unique()


Model_metrics[grep("Q8WWZ3", Model_metrics$DMI),] %>% select(DMI, ) %>% unique()
HuRi_DMI %>% filter(SLiMProtein=="P40763" & Accession=="ELME000278")
```

```{r Figure4_data3}
Scores_json_raw <- read_tsv(file="/Volumes/imb-luckgr/imb-luckgr2/projects/AlphaFold/HuRI_DMI_AF_modelling/Score_files/DMI_model_confidence_all_2.tab", col_names = T, na = "")
Scores_json <- Scores_json_raw %>% filter(rank==1) %>% select(DMI,model, score)
Scores_json$Model <- gsub("_multimer_v3_pred_0","",gsub("model_","",Scores_json$model))
Scores_json <- Scores_json %>% select(-model)
Scores_json$PPI <- gsub("_.*?\\.","-",  gsub("_ELM.*?$","", Scores_json$DMI))

scores_count <- tibble(bin=seq(from = 0, to = 1, by = 0.05), count_dmi=0, count_ppi=0)
cc_v <- c()
pp_v <- c() ## PPI count

for(i in seq(from = 0, to = 1, by = 0.05)){
  cc <- Scores_json %>% filter(score >= i) %>% nrow()
  pp <- Scores_json %>% filter(score >= i) %>% select(PPI) %>% unique() %>% nrow()
  cc_v <- c(cc_v, cc)
  pp_v <- c(pp_v, pp)
}

scores_count$count_dmi <-cc_v 
scores_count$count_ppi <-pp_v 

Scores_json %>% filter(score >= 0.6) %>% nrow()
Scores_json %>% filter(score >= 0.6) %>% select(PPI) %>% unique() %>% nrow()
(Scores_json %>% filter(score >= 0.6) %>% nrow()) /( Scores_json %>% nrow())

Scores_json %>% filter(DMI=="Q9Y4K3_SM00061_O_292_507.Q8WWZ3_ELME000133_D_25_33")


```



```{r Figure5_sankeys_data}
DMI_AF_mut_mapped <- DMI_AF_mut_hq %>% count(structural_region, Mapped_pathogenicity)

DMI_AF_mut_mapped <- DMI_AF_mut_mapped %>% separate(Mapped_pathogenicity, c("ClinVar", "AlphaMissence"), sep="_") %>% rename(value=n)
DMI_AF_mut_mapped$AlphaMissence <-  paste("AM_", DMI_AF_mut_mapped$AlphaMissence, sep="")

nodes <- data.frame(
  name=c(as.character(DMI_AF_mut_mapped$ClinVar), 
  as.character(DMI_AF_mut_mapped$AlphaMissence)) %>% unique()
)

nodes$name <- ordered(nodes$name, levels = c("B","C","P", "U", "AM_B","AM_A","AM_P"))
nodes$group <- ordered(nodes$name, levels = c("B","C","P", "U", "AM_B","AM_A","AM_P"))

DMI_AF_mut_mapped$ClinVar <- match(DMI_AF_mut_mapped$ClinVar, nodes$name)-1 
DMI_AF_mut_mapped$AlphaMissence <- match(DMI_AF_mut_mapped$AlphaMissence, nodes$name)-1

my_color <- 'd3.scaleOrdinal() .domain(["B", "C", "P", "U", "AM_B", "AM_A", "AM_P"]) .range(["#56B4E9", "#E69F00", "#d52221", "#999999",   "#56B4E9", "#E69F00","#d52221"])'
my_color2 <- 'd3.scaleOrdinal() .domain(["B", "C", "P", "U", "AM_B", "AM_P", "AM_A"]) .range(["#56B4E9", "#E69F00", "#d52221", "#999999",   "#56B4E9", "#d52221", "#E69F00"])'
c("#56B4E9", "#E69F00", "#d52221", "#999999",   "#56B4E9", "#E69F00","#d52221")
regions <- DMI_AF_mut_hq %>% select(structural_region) %>% unique() %>% unlist() %>% as.vector()


```

```{r Figure5_Data_GeneSymbols}
stop

GeneSymbols <- read.csv(file="/Volumes/imb-luckgr/imb-luckgr2/projects/AlphaFold/AFDB_HumanReferenceProteome/GeneCode_012025/GeneSymbols_Uniprot.csv")

Symbol_map <- as.vector(GeneSymbols$Symbol)
names(Symbol_map) <- as.vector(GeneSymbols$UniProt)
```

```{r Figure5_Data_Larger_network}
source("/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Networks/visNetwork_DMI_functions.R")


Domain_UB_proteins <- DMI_AF_mut_hq %>% filter( structural_region=="d_interface" & Mapped_pathogenicity=="U_B") %>% select(Chain_protein) %>% unique()
Motif_UB_proteins <- DMI_AF_mut_hq %>% filter(structural_region=="m_interface" & Mapped_pathogenicity=="U_B") %>% select(Chain_protein) %>% unique()

table(Domain_UB_proteins$Chain_protein %in% Motif_UB_proteins$Chain_protein)

UB_proteins <- unique(c(Domain_UB_proteins$Chain_protein, Motif_UB_proteins$Chain_protein)) 

AF_graph <- mk_PPI_network(DMI_AF_metrics)
BU_graph <- slice_PPI_network(as.vector(UB_proteins),AF_graph)

BU_graph[[1]]$id <- Symbol_map[BU_graph[[1]]$id ]
BU_graph[[2]]$from <- Symbol_map[BU_graph[[2]]$from]
BU_graph[[2]]$to <- Symbol_map[BU_graph[[2]]$to]
BU_graph2 <- mk_igraph_PPI_network(BU_graph)


BU_graph[[1]] %>% count(group) #188 extra proteins
# 311 in total


```

```{r Figure5_data_DO_parents}
Protein_disorders_child_parents <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/AF_model_tables/DO_disease_parent_terms_filled.csv")
disease_parent_map <- c("Nervous system disease" = "skyblue", "Disease of metabolism" = "limegreen", "X-Linked monogenic disease"= "orange", "Chromosomal disease" ="yellow","Specific developmental disorder"="pink", "Musculoskeletal system disease"="red", "Other"="darkgrey")

#UB_disorder_net <- HuRi_DMI %>% select(DomainProtein, SLiMProtein) %>% filter(DomainProtein %in% UB_proteins & SLiMProtein %in% UB_proteins) %>% unique()
UB_disorder_net <- HuRi_DMI %>% filter(DMIMatchScore>=0.7) %>% select(DomainProtein, SLiMProtein) %>% filter(SLiMProtein %in% UB_proteins) %>% unique() #From all HuRI interactions which ones have slims proteins with interfacial uncertain variants

UB_disorder_net$DomainSymbol <- Symbol_map[UB_disorder_net$DomainProtein] # Use the symbol map to name the domain proteins
UB_disorder_net$MotifSymbol <- Symbol_map[UB_disorder_net$SLiMProtein] # Use the symbol map to name the motif proteins

UB_pairs_edges <- c(rbind(UB_disorder_net$DomainSymbol , UB_disorder_net$MotifSymbol)) # Interlace the domain and motif pairs in a single vector to create an igraph network
UB_pairs_ig <- make_graph(edges = UB_pairs_edges, directed = T) # Create igraph network

UB_pairs_vertices <- V(UB_pairs_ig)$name %>% as.tibble() %>% rename(Symbol=value) # Get the order of vertices in the igraph network (it is new every time it is created)
UB_pairs_vertices <- left_join(UB_pairs_vertices, GeneSymbols, by="Symbol") %>% rename(GeneSymbol=Symbol) %>% unique() # reAdd UniProt IDs




UB_pairs_vertices <- left_join(UB_pairs_vertices, Protein_disorders_child_parents, by="GeneSymbol", multiple = "first") # Assign the parent terms of the protein disease associations
UB_pairs_vertices <- UB_pairs_vertices %>% select(-SwissProtReference) # Remove Double UniProt columns
UB_pairs_vertices$color <- disease_parent_map[UB_pairs_vertices$parent_term] # Assign node/vertex color depeding on the parent term
UB_pairs_vertices <- UB_pairs_vertices %>% mutate(color=case_when(is.na(color) ~ "lightgrey", TRUE ~ color)) # When there is no assignment, then assign a different color 

UB_pairs_vertices <- UB_pairs_vertices %>% 
  mutate(DomainProtein=case_when(UniProt %in% HuRi_DMI$DomainProtein ~ 1, TRUE ~ 0), MotifProtein=case_when(UniProt %in% HuRi_DMI$SLiMProtein ~ 1, TRUE ~ 0)) %>%
  mutate(Fragment=case_when(DomainProtein==1 & MotifProtein==1 ~ "both", DomainProtein==1 & MotifProtein==0 ~ "domain",DomainProtein==0 & MotifProtein==1 ~ "motif")) %>%
  select(-DomainProtein,-MotifProtein) # Assign fragment type depending on whether or not the protein has DMI with domain, motif or both
UB_pairs_vertices <- UB_pairs_vertices %>% mutate(shape=case_when(Fragment=="both" ~ "circle", Fragment=="domain" ~ "square", Fragment=="motif" ~ "rectangle" )) # Assign shape based on Fragment type

V(UB_pairs_ig)$color <- UB_pairs_vertices$color
V(UB_pairs_ig)$shape <- UB_pairs_vertices$shape

## Create network to export
UB_disorder_network <-  UB_disorder_net %>% rename(UniProt=DomainProtein) %>% rename(GeneSymbol=DomainSymbol)

# UB_disorder_network <- left_join(UB_disorder_network, UB_pairs_edge, by=c("GeneSymbol", "UniProt"))
# UB_disorder_network <-  UB_disorder_network %>% rename(DomainProtein=UniProt) %>% rename(DomainSymbol=GeneSymbol) %>% rename(parent_term_domain=parent_term) %>% rename(GeneSymbol=MotifSymbol) %>% rename(UniProt=SLiMProtein )
# UB_disorder_network <- left_join(UB_disorder_network, UB_pairs_edge, by=c("GeneSymbol", "UniProt"))
# UB_disorder_network <-  UB_disorder_network %>% rename(SLiMProtein=UniProt) %>% rename(MotifSymbol=GeneSymbol) %>% rename(parent_term_motif=parent_term)
# 
# UB_disorder_network <- UB_disorder_network%>% mutate(parent_term = coalesce(parent_term_motif, parent_term_domain))
# UB_disorder_network <- UB_disorder_network %>% mutate(parent_term=case_when(is.na(parent_term) ~ "None", TRUE ~ parent_term))
# UB_disorder_network <- UB_disorder_network %>% select(-parent_term_motif, -parent_term_domain) %>% mutate(parent_term_2 = parent_term)

#write_tsv(UB_disorder_network, file="/Users/jesusav/Desktop/UB_disorder_net_edges.tsv")

# UB_disorder_ver <- rbind(UB_disorder_network %>% select(DomainSymbol, parent_term)  %>% unique() %>% rename(name=DomainSymbol), 
#       UB_disorder_network %>% select(MotifSymbol, parent_term)  %>% unique() %>% rename(name=MotifSymbol)) 
# UB_disorder_ver <- UB_disorder_ver %>% group_by(name) %>% slice(1) %>%ungroup()

UB_disorder_ver <- UB_pairs_vertices %>% mutate(DisorderName=case_when(is.na(DisorderName) ~ "None", TRUE ~ DisorderName), parent_term=case_when(is.na(parent_term) ~ "None", TRUE ~ parent_term)) %>% select(-color, -shape)

#write_tsv(UB_disorder_ver, file="/Users/jesusav/Desktop/UB_disorder_net_vertices.tsv")


```

```{r Figure5_data_GO_terms}
HuRI_UPID <- rbind(HuRi_DMI %>% select(SLiMProtein) %>% unique() %>% rename(ID=SLiMProtein), HuRi_DMI %>% select(DomainProtein) %>% unique() %>% rename(ID=DomainProtein)) %>% unique()
#write_tsv(HuRI_UPID, file="/Users/jesusav/Desktop/HuRI_UPID.txt", col_names = F)

HuRI_GO <- read_tsv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/AF_model_tables/HuRI_proteins_gene_GOterms.tsv")
HuRI_GO <- HuRI_GO %>% select(-From, -Organism, -Reviewed, -`Protein names`)
colnames(HuRI_GO) <- c("UniProt", "Name", "Symbol", "Length", "BP", "MF", "CC")

HuRI_GO_BP <- HuRI_GO %>% select(UniProt, BP) %>% separate_rows(BP, sep=";") %>% separate(BP, c("GO_term", "GO_code"), sep=" \\[GO:") %>% 
  mutate(GO_term=gsub("^ ","",GO_term)) %>% mutate(GO_code=gsub("\\]","",GO_code)) %>% filter(!is.na(GO_term))
HuRI_GO_MF <- HuRI_GO %>% select(UniProt, MF) %>% separate_rows(MF, sep=";") %>% separate(MF, c("GO_term", "GO_code"), sep=" \\[GO:") %>% 
  mutate(GO_term=gsub("^ ","",GO_term)) %>% mutate(GO_code=gsub("\\]","",GO_code)) %>% filter(!is.na(GO_term))
HuRI_GO_CC <- HuRI_GO %>% select(UniProt, CC) %>% separate_rows(CC, sep=";") %>% separate(CC, c("GO_term", "GO_code"), sep=" \\[GO:") %>% 
  mutate(GO_term=gsub("^ ","",GO_term)) %>% mutate(GO_code=gsub("\\]","",GO_code)) %>% filter(!is.na(GO_term))

HuRI_GO_BP %>% count(GO_term) %>% arrange(-n)  # regulation of transcription by RNA polymerase II
HuRI_GO_BP %>% filter(UniProt %in% UB_pairs_vertices$UniProt) %>% count(GO_term) %>% arrange(-n)  # signal transduction
HuRI_GO_MF %>% count(GO_term) %>% arrange(-n) # identical protein binding
HuRI_GO_CC %>% count(GO_term) %>% arrange(-n) # cytosol and nucleus


UB_GO_BP <- HuRI_GO_BP %>% filter(UniProt %in% UB_pairs_vertices$UniProt) %>% mutate(GO_group=gsub("(negative )|(positive )","",GO_term)) %>% mutate(GO_group=gsub("regulation of ","",GO_group)) %>% mutate(GO_group=gsub("intracellular ","",GO_group)) %>% mutate(GO_group=case_when(GO_group=="cell population proliferation" ~ "cell proliferation", GO_group=="cell cycle" ~ "cell proliferation", GO_group=="cell division" ~ "cell proliferation" , GO_group=="protein autophosphorylation" ~ "protein phosphorylation" , TRUE ~ GO_group)) 

GO_map <- c("transcription by RNA polymerase II" = "skyblue", "signal transduction" = "limegreen", "protein phosphorylation" = "red", "apoptotic process" ="yellow", "cell proliferation"= "orange", "DNA-templated transcription"="pink",  "Other"="darkgrey")

HuRI_GO_BP_sel <- left_join(UB_GO_BP, UB_GO_BP %>% count(GO_group)) %>% arrange(-n) %>% group_by(UniProt) %>% slice(1) %>% ungroup() %>%  
                              mutate(Group=case_when(n > 40 ~  GO_group, TRUE ~ "Other"))  %>% select(UniProt, GO_term, Group)

#UB_pairs_ig <- make_graph(edges = UB_pairs_edges, directed = T)

UB_pairs_vertices <- left_join(UB_pairs_vertices, HuRI_GO_BP_sel, by="UniProt", multiple = "first")

UB_pairs_vertices$color2 <- GO_map[UB_pairs_vertices$Group]
UB_pairs_vertices <- UB_pairs_vertices %>% mutate(color2=case_when(is.na(color2) ~ "darkgrey", TRUE ~ color2)) %>% mutate(color2=case_when(is.na(Group) ~ "lightgrey", TRUE ~ color2))


UB_GO_ver <- UB_pairs_vertices %>% mutate(DisorderName=case_when(is.na(DisorderName) ~ "None", TRUE ~ DisorderName), parent_term=case_when(is.na(parent_term) ~ "None", TRUE ~ parent_term)) %>% select(GeneSymbol, UniProt, Fragment, GO_term, Group, color2)

#write_tsv(UB_GO_ver, file="/Users/jesusav/Desktop/UB_GO_net_vertices.tsv")
```

```{r Figure5_data_Uncertain_HuRI_essentiality}
HuRI_essentiality <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/HuRI_paper_tables/HuRI_Essentiality.csv")
HuRI_essentiality <- HuRI_essentiality %>% select(Gene_symbol, Fitness_effect) %>% rename(Symbol=Gene_symbol)

HuRI_age <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/HuRI_paper_tables/HuRI_Age.csv")
HuRI_age <- HuRI_age %>% select(Gene_symbol, Age) %>% rename(Symbol=Gene_symbol)

HuRI_exp <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/HuRI_paper_tables/HuRI_Exp_GTEx.csv")
HuRI_exp <- HuRI_exp %>% select(Gene_symbol, Median_expression) %>% rename(Symbol=Gene_symbol)

HuRI_LoFint <- read_csv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/HuRI_paper_tables/HuRI_LoFint.csv")
HuRI_LoFint <- HuRI_LoFint %>% select(Gene_symbol, pLI) %>% rename(Symbol=Gene_symbol)

UB_proteins_sym <- GeneSymbols %>% filter(UniProt %in% UB_proteins)
UB_proteins_sym <-left_join(UB_proteins_sym, HuRI_essentiality)
UB_proteins_sym <-left_join(UB_proteins_sym, HuRI_age)
UB_proteins_sym <-left_join(UB_proteins_sym, HuRI_exp)
UB_proteins_sym <-left_join(UB_proteins_sym, HuRI_LoFint)
UB_proteins_sym <- UB_proteins_sym %>% arrange(-Fitness_effect)

Protein_mutant <- DMI_AF_mut_hq %>% select(Chain_protein, residue_n, Pathogenicity, M_number)%>% unique() %>% 
  count(Chain_protein, Pathogenicity) %>% rename(UniProt=Chain_protein) %>% pivot_wider(names_from = Pathogenicity, values_from = n) %>% select(-Benign, -Conflicting)
UB_proteins_sym <-left_join(UB_proteins_sym, Protein_mutant)
UB_proteins_sym <- UB_proteins_sym %>% mutate(Motif=case_when(UniProt %in% HuRi_DMI$SLiMProtein ~ 1, TRUE ~ 0)) %>% mutate(Domain=case_when(UniProt %in% HuRi_DMI$DomainProtein ~ 1, TRUE ~ 0))
UB_proteins_sym <- UB_proteins_sym %>% unique()

UB_proteins_sym %>% filter(Fitness_effect>0.15 & Median_expression>10 & pLI>0.9) %>% arrange(-Uncertain) # 6 proteins
#ggplot(UB_proteins_sym %>% filter(!is.na(Fitness_effect)), aes(y=Fitness_effect)) + geom_boxplot()

#Q9C0A6 SETD5 N-methyltransferase
acc <- HuRi_DMI %>% filter(SLiMProtein=="Q9C0A6") %>% select(Accession) %>% unique() %>% unlist()
HURI_ClinVar_mutation %>% filter(fragment_protein=="Q9C0A6" & pathogenicity=="Uncertain") %>% filter(fragment_id %in% acc) 

#Q9C0A6 SETD5 N-methyltransferase
acc <- HuRi_DMI %>% filter(SLiMProtein=="Q6UB99") %>% select(Accession) %>% unique() %>% unlist()
HURI_ClinVar_mutation %>% filter(fragment_protein=="Q6UB99" & pathogenicity=="Uncertain") %>% filter(fragment_id %in% acc) #%>% select(aa_change) %>% unique()


HuRi_DMI %>% filter(ELM_type=="DEG" & SLiMProtein %in% UB_proteins_sym$UniProt) 
HuRi_DMI %>% filter(ELM_type=="DEG" & SLiMProtein %in% UB_proteins_sym$UniProt) %>% select(SLiMProtein) %>% unique()

UB_motif_degrons <- DMI_AF_mut_hq %>% filter(structural_region=="m_interface" & Mapped_pathogenicity=="U_B") %>% 
  mutate(Motif_accession=gsub("_D.*?$", "", gsub("*.*?_ELM", "ELM", DMI)))
UB_motif_degrons <- left_join(UB_motif_degrons, ELM_classes) %>% filter(ELM_type=="DEG")

UB_motif_degrons %>% select(DMI, Chain_protein, residue_n, M_number, ELM_class)
UB_motif_degrons %>% separate(DMI, c("Domain", "Motif"), sep="\\.") %>% select(Chain_protein) %>% unique()
UB_motif_degrons %>% separate(DMI, c("Domain", "Motif"), sep="\\.") %>% select(Motif) %>% unique()
# 15 DMIs, 10 AF models, 2 degron classes, 9 motif instances in 6 proteins
```

```{r Figure5_data_Motif_REGEX_change}
DMI_AF_mut_hq_motif <- DMI_AF_mut_hq %>% filter(Fragment=="Motif")

HURI_ClinVar_mut_motif_2 <- read_tsv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/HuRI_DMIs-ClinVar_mutations/DMI_human_HuRI_overlap_clinvar_2023_release_MotifDisruption.tsv")

HURI_ClinVar_mut_motif_pLDDT <- read_tsv(file="/Volumes/imb-luckgr/Luck_lab_members/Jesus/DMIs_ClinVar/Datasets/HuRI_DMIs-ClinVar_mutations/DMI_human_HuRI_overlap_clinvar_2023_release_MotifpLDDT.tsv")

HURI_ClinVar_mut_motif_summ <- HURI_ClinVar_mut_motif_2 %>% 
  mutate(residue_n=as.double(gsub("[A-z]","",aa_change))) %>% 
  count(fragment_protein, Accession,ELMIdentifier, fragment_pos, pathogenicity, residue_n,variant_match)

DMI_AF_mut_hq_temp <- DMI_AF_mut_hq %>% select(DMI, pLDDT, Norm_Acc, Acc_change,residue_n, Chain_protein, Fragment_id,structural_region, Pathogenicity, AM_pathogenicity)

HURI_ClinVar_mut_motif_summ <-  HURI_ClinVar_mut_motif_summ %>% rename(Chain_protein=fragment_protein, Fragment_id=Accession) %>% mutate(ELM_type=gsub("_.*?$","", ELMIdentifier))

HURI_ClinVar_mut_motif_summ <- left_join(HURI_ClinVar_mut_motif_summ, DMI_AF_mut_hq_temp)
HURI_ClinVar_mut_motif_summ <- HURI_ClinVar_mut_motif_summ %>% filter(!is.na(DMI))

HURI_ClinVar_mut_motif_summ <- left_join(HURI_ClinVar_mut_motif_summ, Model_metrics)

UB_motif_degrons <- HURI_ClinVar_mut_motif_summ %>% filter(structural_region=="m_interface" & ELM_type=="DEG" & pathogenicity=="Uncertain" & variant_match==0 & pLDDT<70) %>% unique()

HURI_ClinVar_mut_motif_summ %>% filter(structural_region=="m_interface" & ELM_type=="DEG" & pathogenicity=="Uncertain"& variant_match==0 & pLDDT>70)
UB_motif_degrons
```

```{r Degron_examples}

UB_motif_degrons %>% select(Chain_protein ) %>% unique()
# 14 DMIs, 10 AF models, 3 degron classes, 9 motif instances in 7 proteins
# PALB2 DEG_Kelch_Keap1_1 degron  various VUS do not have disease association, other parts are associated with breast cancer
HURI_ClinVar_mut_motif_summ %>% filter(Chain_protein=="Q13501" & structural_region=="m_interface" & variant_match==0 & fragment_pLDDT<70) %>% select(DMI, ELMIdentifier) %>% unique()
# Q14145_SM00612_O_317_621.Q13501_ELME000390_D_347_352	DEG_Kelch_Keap1_1
# Paget Disease of Bone 3
HURI_ClinVar_mutation %>% filter(fragment_protein=="Q13501" & fragment_id=="ELME000390") %>% select(-fragment_protein, fragment_id) %>% 
  select(aa_change) %>% unlist()

HURI_ClinVar_mut_motif_summ %>% filter(structural_region=="m_interface" & pathogenicity=="Uncertain" & variant_match==0 & fragment_pLDDT<70 & AM_pathogenicity=="AM_benign")
# Q99816_SM00212_O_1_311.Q6UWE0_ELME000099_D_648_653, Q99816_SM00212_O_1_311.Q6UWE0_ELME000099_D_660_665 LIG_PTAP_UEV_1 
# Charcot-Marie-Tooth disease axonal type 2P
HURI_ClinVar_mutation %>% filter(fragment_protein=="Q6UWE0" & fragment_id=="ELME000099") %>% select(-fragment_protein, fragment_id) %>% 
  select(aa_change) %>% unlist()


UB_motif_degrons <- HURI_ClinVar_mut_motif_summ %>% filter(structural_region=="m_interface" & ELM_type=="LIG" & pathogenicity=="Uncertain" & variant_match==0 & fragment_pLDDT<70) %>% unique()
UB_motif_degrons %>% select(Chain_protein ) %>% unique()

ClinVar_mut_dis_short <- ClinVar_mut_dis %>% filter(!is.na(AM_pathogenicity)) %>% select(UniProt_ID, aa_change, pathogenicity,avg_pLDDT,avg_IUPred, dis_pLDDT, dis_IUPred, AM_value,AM_pathogenicity) %>% rename(fragment_protein=UniProt_ID )
HURI_ClinVar_mut_motif_2 <- left_join(HURI_ClinVar_mut_motif_2, ClinVar_mut_dis_short)

Model_metrics %>% filter()
# 	Q14145_SM00612_O_317_621.Q86YC2_ELME000390_D_89_94

HURI_ClinVar_mut_motif_summ %>% select(Chain_protein, Fragment_id, fragment_pos) %>% unique()
HURI_ClinVar_mut_motif_summ %>% count(pathogenicity, variant_match) %>% mutate(proportion=n/nrow(HURI_ClinVar_mut_motif_summ))
HURI_ClinVar_mut_motif_summ %>% filter(pathogenicity=="Uncertain") %>% count(variant_match) %>% mutate(proportion=n/2657)
```



```{r misc}
#functions for saving images in pdf
cm2in <- function(cm_num){
  in_num <- cm_num/2.54
  return(in_num)
}
```

```{r Figure1_Graphic_a_ClinVar_count}
# Number of ClinVar variants
p1 <- ggplot(ClinVar_mutations, aes(y=pathogenicity , fill=pathogenicity)) + geom_bar(width = 0.6) +
  ggtitle("ClinVar variant pathogenicity") +  ylab("Clinical relevance") + xlab("Variant number") + xlim(0, 850000) +
  theme_classic() + scale_fill_manual(values = colors_Var) + labs(fill = "Pathogenicity") +
  theme(text = element_text(size = 15), axis.text = element_text(color = "black"), legend.position = "none",  
        axis.ticks = element_line(linewidth = 1), axis.text.x = element_text(angle = 30, vjust = 1, hjust=1)) + 
  scale_x_continuous(labels = scales::comma) + scale_y_discrete(limits=rev) 
p1
# with labels
p1 +geom_text(aes(label = ..count..), stat = "count", vjust = -2, position = position_dodge(0.9), size = 3.5) +
  geom_text(stat='prop', vjust=-0.5, , position = position_dodge(0.9), size=3)

#SAVE TIFF
tiff("Figures/Figure1_graphics/ClinVar_mutations.tiff", units="cm", width=10, height=7, res=800)
p1
dev.off()
#SAVE PDF
pdf("Figures/Figure1_graphics/ClinVar_mutations.pdf", width=cm2in(10), height=cm2in(7))
p1
dev.off()

```

```{r Figure1_Graphic_b_ChiSq_pLDDT}
### Correlations plots - pLDDT classification
## https://cscu.cornell.edu/wp-content/uploads/conttableresid.pdf
Pathogenicity_pLDDT_chisq$residuals
Pathogenicity_pLDDT_chisq$observed
alpha_val <- 0.05
abs(Pathogenicity_pLDDT_chisq$stdres/(sd(Pathogenicity_pLDDT_chisq$residuals))) > qnorm(1-(alpha_val/length(Pathogenicity_pLDDT_chisq$residuals))/2)


corrplot(Pathogenicity_pLDDT_chisq$residuals, method = 'color', is.corr  = FALSE, col = rev(COL2('RdBu')), 
         cl.pos = 'b', addCoef.col = 'grey50', number.cex = 0.01, col.lim= c(-80, 80))
corrplot(Pathogenicity_pLDDT_chisq$stdres, method = 'color', is.corr  = FALSE, col = rev(COL2('RdBu')), 
         cl.pos = 'b', addCoef.col = 'grey50', number.cex = 0.01)

#SAVE TIFF
tiff("Figures/Figure1_graphics/ClinVar_pLDDT_disorder_chisq.tiff", units="cm", width=10, height=20, res=800)
corrplot(Pathogenicity_pLDDT_chisq$stdres, method = 'color', is.corr  = FALSE, col = rev(COL2('RdBu')), 
         cl.pos = 'b', addCoef.col = 'grey50', number.cex = 0.01, col.lim= c(-110, 110))
dev.off()
#SAVE PDF
pdf("Figures/Figure1_graphics/ClinVar_pLDDT_disorder_chisq.pdf", width=cm2in(10), height=cm2in(20))
corrplot(Pathogenicity_pLDDT_chisq$stdres, method = 'color', is.corr  = FALSE, col = rev(COL2('RdBu')), 
         cl.pos = 'b', addCoef.col = 'grey50', number.cex = 0.01, col.lim= c(-110, 110))
dev.off()

# Comparison of just pathogens vs uncertain variants
Pathogenicity_pLDDT_PU_chisq$residuals
Pathogenicity_pLDDT_PU_chisq$observed
abs(Pathogenicity_pLDDT_PU_chisq$stdres/(sd(Pathogenicity_pLDDT_PU_chisq$residuals))) > qnorm(1-(alpha_val/length(Pathogenicity_pLDDT_PU_chisq$residuals))/2)

corrplot(Pathogenicity_pLDDT_PU_chisq$residuals, method = 'color', is.corr = FALSE, col = rev(COL2('RdBu')),
         cl.pos = 'b', addCoef.col = 'grey50', number.cex = 0.01, col.lim= c(-80, 80))


```

```{r Figure1_Graphic_c_ELM_classes}
p1 <- ggplot(All_ELM_types, aes(x="", y=n, fill=ELM_type)) +
  geom_bar(stat="identity", width=1) +
  scale_fill_manual(values=colors_ELMtypes) +
  coord_polar("y", start=0) + theme_void() + theme(legend.position="none")
p1

#SAVE TIFF
tiff("Figures/Figure1_graphics/ELM_types_charts.tiff", units="cm", width=8, height=8, res=800)
p1
dev.off()

#SAVE PDF
pdf("Figures/Figure1_graphics/ELM_types_charts.pdf", width=4, height=4)
p1
dev.off()
```

```{r Figure1_Graphic_d_ROC_PRC_curves}
p1 <- ggplot(RRS_ROC, aes(x=mean_fpr, y=mean_tpr, fill=RRS)) +  geom_line(color="grey30") + 
  geom_ribbon(aes(y = mean_tpr, ymin = mean_tpr - std_tpr, ymax = mean_tpr + std_tpr), alpha = 0.3) +
  #annotate(geom="text", label="mean AUC = 0.93", x=0.7, y=0.1, size=3, color="red")+
  ggtitle("RRS ROC") + xlab("1 - Specificity") + ylab("Sensitivity") + 
  theme_classic() + 
  theme(text = element_text(size = 25), axis.text = element_text(color = "black"), legend.position = "none") + 
  scale_x_continuous(breaks=c(0,0.5,1)) + scale_y_continuous(breaks=c(0,0.5,1)) 

p1
p1 + geom_point() + geom_text(aes(label = mean_tpr), vjust = -1, hjust = -0.2, size = 3) 

#SAVE TIFF
tiff("Figures/Figure1_graphics/DMI_predictor_ROC.tiff", units="cm", width=8, height=8, res=800)
p1
dev.off()
#SAVE PDF
pdf("Figures/Figure1_graphics/DMI_predictor_ROC.pdf", width=4, height=4)
p1
dev.off()

p2 <- ggplot(RRS_PRC, aes(x=mean_recall, y=mean_precision, fill=RRS)) +  geom_line(color="grey30") +
  geom_ribbon(aes(y = mean_precision, ymin = mean_precision - std_precision, ymax = mean_precision + std_precision), alpha = 0.3) +
  #annotate(geom="text", label="mean AP = 0.93", x=0.3, y=0.5, size=3, color="red")+
  ggtitle("RRS PRC") + xlab("Recall") + ylab("Precision") + 
  theme_classic() + 
  theme(text = element_text(size = 25), axis.text = element_text(color = "black"),legend.position = "none") + 
  scale_x_continuous(breaks=c(0,0.5,1)) 

p2
p2 + geom_point() + geom_text(aes(label = mean_precision), vjust = -1, hjust = -0.2, size = 3) 

#SAVE TIFF
tiff("Figures/Figure1_graphics/DMI_predictor_PRC.tiff", units="cm", width=8, height=8, res=800)
p2
dev.off()
#SAVE PDF
pdf("Figures/Figure1_graphics/DMI_predictor_PRC.pdf", width=4, height=4)
p2
dev.off()


```

```{r Figure1_Graphic_e_HuRI_DMI_categories}
p1 <- ggplot(HuRI_DMIs %>% filter(DMIMatchScore >= 0.7), aes(y = ELM_type, fill = ELM_type)) + geom_bar(width = 0.7) + 
  ylab("ELM category") + xlab("DMI number") + 
  scale_fill_manual(values=colors_ELMtypes) + 
  theme_classic() + theme(text = element_text(size = 18), legend.position="none", axis.text = element_text(color = "black"),
                  axis.ticks = element_line(linewidth = 1), axis.text.x = element_text(angle = 30, vjust = 1, hjust=1)) + 
  scale_x_continuous(labels = scales::comma, limits = c(0,7000)) + 
  scale_y_discrete(limits=rev, labels = rev(elm_categories)) 
p1

p1 + geom_text(stat='count', aes(label=format(after_stat(count), big.mark=",")), vjust=-2, size=3) +
  geom_text(stat='prop', vjust=-0.25, size=3) 

# SAVE TIFF
tiff("Figures/Figure1_graphics/HuRI_DMI_higScore.tiff", units="cm", width=12, height=8, res=800)
p1
dev.off()

# SAVE PDF
pdf("Figures/Figure1_graphics/HuRI_DMI_higScore.pdf", width=cm2in(12), height=cm2in(8))
p1
dev.off()

p2 <- ggplot(HuRI_DMIs %>% filter(DMIMatchScore >= 0.7) %>% select(intx_ID, ELM_type) %>% unique(), aes(y = ELM_type, fill = ELM_type)) + 
  geom_bar(width = 0.7) + 
  ylab("ELM category") + xlab("PPI number") + 
  scale_fill_manual(values=colors_ELMtypes) +  
  theme_classic() + theme(text = element_text(size = 18), legend.position="none", axis.text = element_text(color = "black"), 
                 axis.ticks = element_line(linewidth = 1), axis.text.x = element_text(angle = 30, vjust = 1, hjust=1)) + 
  scale_x_continuous(labels = scales::comma, limits = c(0,2000)) + 
  scale_y_discrete(limits=rev, labels = rev(elm_categories)) 
p2

p2 + geom_text(stat='count', aes(label=format(after_stat(count), big.mark=",")), vjust=-2, size=3) +
  geom_text(stat='prop', vjust=-0.25, size=3) 

# SAVE TIFF
tiff("Figures/Figure1_graphics/HuRI_DMI_higScore_PPI.tiff", units="cm", width=12, height=8, res=800)
p2
dev.off()

# SAVE PDF
pdf("Figures/Figure1_graphics/HuRI_DMI_higScore_PPI.pdf", width=cm2in(12), height=cm2in(8))
p2
dev.off()

```

```{r Figure1_Graphic_f_DMI_ClinVar_fragments}

p1 <- ggplot(HURI_ClinVar_mutation, aes(x=fragment_type , fill=pathogenicity)) + 
  geom_bar(position="fill", width = 0.6, color="black", size=0.3) +
  ggtitle("DMI - Region variants") +  xlab("Protein region") + ylab("Variant fraction") + 
  theme_minimal() + scale_fill_manual(values=colors_Var) + labs(fill = "Pathogenicity") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), legend.position = "null", 
        axis.text = element_text(color = "black"),panel.grid.minor = element_blank(), 
        axis.ticks.y = element_line(linewidth = 0.5), axis.title.x=element_blank())+
  scale_y_continuous(breaks = scales::pretty_breaks(n = 3)) 

p1
p1 +geom_text(aes(label = ..count..), stat = "count", vjust = -0.1,hjust= 1, position = position_fill(0.25), size = 3) +
  geom_text(stat='prop', vjust=-0.1, hjust= -0.1, position = position_fill(0.25), size=3) 


# SAVE TIFF
tiff("Figures/Figure1_graphics/HuRI_human_ClinVar_mutations_fragment.tiff", units="cm", width=9, height=8, res=800)
p1
dev.off()
# SAVE PDF
pdf("Figures/Figure1_graphics/HuRI_human_ClinVar_mutations_fragment.pdf", width=cm2in(9), height=cm2in(8))
p1
dev.off()

p1 <- ggplot(HURI_ClinVar_mutation, aes(x=fragment_type , fill=pathogenicity)) + 
  geom_bar(position="fill", width = 0.6, color="black", size=0.2) +
  ggtitle("DMI - Region variants") +  xlab("Protein region") + ylab("Variant fraction") + 
  theme_minimal() + scale_fill_manual(values=colors_Var) + labs(fill = "Pathogenicity") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"),panel.grid.minor = element_blank(), 
        axis.ticks.y = element_line(linewidth = 0.5), axis.title.x=element_blank())+
  scale_y_continuous(breaks = scales::pretty_breaks(n = 3)) 
p1

grid.draw(cowplot::get_legend(p1))
# SAVE TIFF
tiff("Figures/Figure1_graphics/ClinVar_legend.tiff", units="cm", width=5, height=5, res=800)
grid.draw(cowplot::get_legend(p1))
dev.off()
# SAVE PDF
pdf("Figures/Figure1_graphics/ClinVar_legend.pdf", width=cm2in(5), height=cm2in(5))
grid.draw(cowplot::get_legend(p1))
dev.off()



```

```{r Figure1_Graphic_g_ChiSqr_regions}
corrplot(Fragment_contingency_chisq$residuals, method = 'color', is.cor = FALSE,col = rev(COL2('RdBu')), col.lim= c(-35, 35), cl.pos = 'b', addCoef.col = 'grey50', outline=T, addgrid.col="white")

corrplot(Fragment_contingency_chisq$stdres, method = 'color', is.cor = FALSE,col = rev(COL2('RdBu')), cl.pos = 'b', addCoef.col = 'grey50', outline=T, addgrid.col="white")

corrplot(Fragment_contingency_chisq$stdres/sd(Fragment_contingency_chisq$residuals), method = 'color', is.cor = FALSE,col = rev(COL2('RdBu')), col.lim= c(-3,3), cl.pos = 'b', addCoef.col = 'grey50', outline=T, addgrid.col="white")

abs(Fragment_contingency_chisq$stdres/(sd(Fragment_contingency_chisq$residuals))) > qnorm(1-(0.05/length(Fragment_contingency_chisq$residuals))/2)
Fragment_contingency_chisq$observed

# SAVE TIFF
tiff("Figures/Figure1_graphics/DMI_fragment_mutation_enrichment.tiff", units="cm", width=10, height=20, res=800)
corrplot(Fragment_contingency_chisq$stdres, method = 'color', is.cor = FALSE,col = rev(COL2('RdBu')), cl.pos = 'b', addCoef.col = 'grey50', outline=T, addgrid.col="white", number.cex = 0.01, col.lim= c(-36, 36))
dev.off()

# SAVE PDF
pdf("Figures/Figure1_graphics/DMI_fragment_mutation_enrichment.pdf", width=cm2in(10), height=cm2in(20))
corrplot(Fragment_contingency_chisq$stdres, method = 'color', is.cor = FALSE,col = rev(COL2('RdBu')), cl.pos = 'b', addCoef.col = 'grey50', outline=T, addgrid.col="white", number.cex = 0.01, col.lim= c(-36, 36))
dev.off()

round(Fragment_contingency_chisq$observed,2)
```




```{r ED_Figure1_Graphic_a_ClinVar_pLDDT}
p1 <- ggplot(ClinVar_mut_dis, aes(x=avg_pLDDT, y=pathogenicity , color=as.factor(pathogenicity))) + 
  geom_quasirandom(size=0.5, alpha=0.4) + geom_boxplot(color="black", width=0.25, outlier.alpha = 0.2, alpha=0.5) +
  geom_vline(xintercept = 70 , size=0.5, color="red") + 
  ylab("Clinical relevance") + xlab("Residue pLDDT") + 
  theme_classic()  +  scale_color_manual(values=colors_Var) +
  theme(text = element_text(size = 20), axis.text = element_text(color = "black"), legend.position = "none", 
        plot.title = element_blank(), axis.ticks = element_line(linewidth = 1)) + scale_y_discrete(limits=rev) 

p1

#SAVE PNG
png("Figures/ExtendedData_Figures/ClinVar_pLDDT.png", units="cm", width=11, height=8, res=800)
p1
dev.off()
# #SAVE PDF
# pdf("Figures/Figure1_graphics/ClinVar_pLDDT.pdf", width=cm2in(11), height=cm2in(8))
# p1
# dev.off()

```

```{r EF_Figure1_Graphic_b_FeatureImportance}
p1 <- ggplot(feat_summary, aes(x=importance_mean, y=reorder(Feature,importance_mean))) + 
  geom_bar(stat="identity", fill="darkgrey") + 
  geom_errorbar(aes(xmin = importance_mean-importance_sd, xmax = importance_mean+importance_sd), width=.2)+
  ylab("Feature") + xlab("Importance") +  
  theme_classic()  +  
  theme(text = element_text(size = 18), axis.text = element_text( color = "black"), axis.text.y = element_text(size = 12), legend.position = "none", 
        plot.title = element_blank(), axis.ticks = element_line(linewidth = 1)) 
p1
#SAVE PNG
tiff("Figures/ExtendedData_Figures/RF_feature_importance.tiff", units="cm", width=12, height=8, res=800)
p1
dev.off()



ggplot(features %>% filter(RSS4==1), aes(x=Importance, y=reorder(Feature,Importance))) + 
  geom_bar(stat="identity", fill="darkgrey") + 
  ylab("Feature") + xlab("Importance") +  
  theme_classic()  +  
  theme(text = element_text(size = 18), axis.text = element_text( color = "black"), axis.text.y = element_text(size = 12), legend.position = "none", 
        plot.title = element_blank(), axis.ticks = element_line(linewidth = 1)) 
```

```{r ED_Figure1_Graphic_c_DMI_scores}

coeff <-  max(DMIscores_count$count_ppi) /max(DMIscores_count$count_dmi)

p1 <- ggplot(DMIscores_count, aes(x=bin)) +  geom_line( aes(y=count_dmi), size=1) + geom_line( aes(y=count_ppi / coeff)) + 
  annotate(geom="text", label=c("0.7","DMI","PPI"), x=c(0.78,0.25,0.45), y=c(140000,60000,120000), size=5, color=c("red","black","black") )+ 
  geom_vline(xintercept = 0.7, size=0.5, color="red") + 
  ggtitle("HuRI DMI scores") + xlab("DMI score") +
  theme_classic() + 
  theme(text = element_text(size = 20), axis.text = element_text(color = "black"), axis.ticks = element_line(linewidth = 1))+ 
  scale_y_continuous(labels = scales::comma, , limits = c(0,150000), name = "DMI count", sec.axis = sec_axis(~.*coeff, name="PPI count"))

p1
# SAVE TIFF
tiff("Figures/ExtendedData_Figures/DMIScore_cummulative_DMI_PPI.tiff", units="cm", width=12, height=8, res=800)
p1
dev.off()

# SAVE PDF
pdf("Figures/ExtendedData_Figures/DMIScore_cummulative_DMI_PPI.pdf", width=5, height=3)
p1
dev.off()


p2 <- ggplot(DMIscores_count, aes(x=bin, y=count_dmi)) +  geom_line() + 
  annotate(geom="text", label="0.7", x=0.78, y=140000, size=5, color="red")+ 
  geom_vline(xintercept = 0.7, size=0.5, color="red") + 
  ggtitle("HuRI DMI scores") + xlab("RF score") + ylab("DMI count") + 
  theme_classic() + theme(text = element_text(size = 20), axis.line = element_line(size = 1), axis.text = element_text(color = "black"), axis.ticks = element_line(linewidth = 1)) + 
  scale_y_continuous(labels = scales::comma, limits = c(0,150000)) 

p2 + geom_point() +
  annotate(geom="text", label="Step = 0.05", x=0.2, y=4000, size=3.5)+
  geom_text(aes(label = count_dmi), vjust = -1, hjust = -0.2, size = 3) 


p3 <- ggplot(DMIscores_count, aes(x=bin, y=count_ppi)) +  geom_line() + 
  annotate(geom="text", label="0.7", x=0.78, y=8000, size=5, color="red")+ 
  geom_vline(xintercept = 0.7, size=0.5, color="red") + 
  ggtitle("HuRI DMI scores") + xlab("RF score") + ylab("PPI count") + 
  theme_classic() + theme(text = element_text(size = 20), axis.line = element_line(size = 1), axis.text = element_text(color = "black"), axis.ticks = element_line(linewidth = 1))+ 
  scale_y_continuous(labels = scales::comma) 

p3 + geom_point() +
  annotate(geom="text", label="Step = 0.05", x=0.2, y=4000, size=3.5)+
  geom_text(aes(label = count_ppi), vjust = -1, hjust = -0.2, size = 3) 



```

```{r ED_Figure1_Graphic_d_DMI_scores_categories}
p1 <- ggplot(HuRI_DMIs, aes(x=DMIMatchScore, y = ELM_type, color = ELM_type)) + geom_quasirandom(size=0.1, alpha=0.5) + #geom_beeswarm(corral = "wrap", alpha=0.2, size=0.1) + 
  geom_boxplot(color="black", width=0.15, lwd=0.4, alpha=0.75, outlier.size = 1, outlier.alpha = 0.5) + 
  geom_vline(xintercept = 0.7, color="red") +
  ylab("Motif category") + xlab("DMI score") + 
  scale_color_manual(values=colors_ELMtypes) +
  theme_classic() + theme(text = element_text(size = 18), legend.position="none", 
                          axis.text = element_text(color = "black"),axis.ticks = element_line(linewidth = 1))+ 
  scale_y_discrete(limits=rev, labels = rev(elm_categories)) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 3)) 
p1

#SAVE png
png("Figures/SuppFig_DMI_HuRI_graphics/HuRI_DMI_Scores.png", units="cm", width=11, height=8, res=800)
p1
dev.off()
# SAVE PDF
# pdf("Figures/SuppFig_DMI_HuRI_graphics/HuRI_DMI_Scores.pdf", width=4, height=3)
# p1
# dev.off()
```

```{r ED_Figure1_Graphic_e_DMI_classes_categories}
HuRI_DMI_classes <- HuRI_DMIs %>% select(Accession, ELM_class, ELM_type) %>% unique()
HuRI_DMI_classes_high <- HuRI_DMIs %>% filter(DMIMatchScore >= 0.7) %>% select(Accession, ELM_class, ELM_type) %>% unique()
HuRI_DMI_classes <- HuRI_DMI_classes %>% mutate(HighScored=case_when(Accession %in% HuRI_DMI_classes_high$Accession ~ "1", TRUE ~ "0"))

colors_ELMtypes_ln <- c(rbind(rep("lightgrey",6), colors_ELMtypes))

p1 <- ggplot(HuRI_DMI_classes, aes(y=ELM_type , fill=interaction(HighScored, ELM_type))) + 
  geom_bar(position="fill", width = 0.6, color="black", size=0.4) +
  ylab("Motif category") + xlab("Motif class fraction") + 
  theme_minimal() + scale_fill_manual(values=colors_ELMtypes_ln) + labs(fill = "High Scored\nDMI classes") +
  theme(text = element_text(size = 20), axis.text = element_text(color = "black"), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), axis.ticks = element_line(size = 0.5), axis.ticks.y = element_line(size = 0),
        legend.position="none")+ 
  scale_y_discrete(limits=rev, labels = rev(elm_categories)) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 3)) 
p1
p1 + geom_text(aes(label = ..count..), stat = "count", vjust = -0.1,hjust= 1, position = position_fill(0.25), size = 3) +
  geom_text(stat='prop', vjust=-0.1, hjust= -0.1, position = position_fill(0.25), size=3) 

# SAVE TIFF
tiff("Figures/ExtendedData_Figures/HuRI_DMI_highScore_Classes_fraction.tiff", units="cm", width=11, height=8, res=800)
p1
dev.off()

# SAVE PDF
pdf("Figures/ExtendedData_Figures/HuRI_DMI_highScore_Classes_fraction.pdf", width=5, height=3)
p2
dev.off()

```

```{r ED_Figure1_Graphic_f_DMI_known_instances}
p1 <- ggplot(DMI_ELM_instances, aes(y=DMIMatchScore, x = ELM_instance, color = ELM_instance)) + geom_quasirandom(size=1, alpha=0.75) + 
  geom_boxplot(color = "black", width = 0.15, lwd = 0.4, alpha = 0.75, outlier.size = 1, outlier.alpha = 0.5) + 
  ggtitle("HuRi DMIs - ELM") +  xlab("Known DMI instance") + ylab("DMI score") + 
  scale_color_manual(values = colors_BIN) +
  theme_classic() + theme(text = element_text(size = 18), legend.position="none", 
                          axis.text = element_text(color = "black"),axis.ticks = element_line(linewidth = 1))
p1

# SAVE png
png("Figures/ExtendedData_Figures/Supp_HuRI_DMI_scores_instances.png", units="cm", width=8, height=8, res=800)
p1
dev.off()

p1 <- ggplot(DMI_ELM_instances, aes(y=DMIMatchScore, x = ELM_motif, color = ELM_motif)) + geom_quasirandom(size=0.5, alpha=0.5) + 
  geom_boxplot(color="black", width=0.15, lwd=0.4, outlier.size = 1, outlier.alpha = 0.5) + 
  ggtitle("HuRi DMIs - ELM") +  xlab("ELM instance") + ylab("DMI score") + 
  scale_color_manual(values=colors_BIN) +
  theme_classic() + theme(text = element_text(size = 18), legend.position="none", 
                          axis.line = element_line(size = 1), axis.ticks = element_line(linewidth = 1))
p1
```

```{r ED_Figure1_Graphic_g_DMI_ClinVar_overlaps}

p1 <- ggplot(HURI_ClinVar_DMI_mut_count_DMI_long, aes(y=pathogenicity, fill=pathogenicity)) + 
  geom_bar( width = 0.5) +
  xlab("DMI number") + ylab("Clinical relevance") + 
  theme_classic() + scale_fill_manual(values=colors_Var) + labs(fill = "Clinical relevance") +
  theme(text = element_text(size = 20), legend.position = "none", axis.text = element_text(color = "black"),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), axis.ticks = element_line(linewidth = 1)) + 
  scale_x_continuous(labels = scales::comma, limits = c(0,11000)) + scale_y_discrete(limits=rev) 

p1
p1 +  geom_text(aes(label = ..count..), stat = "count", vjust = -1, position = position_dodge(0.9), size = 3.5)

# SAVE TIFF
tiff("Figures/ExtendedData_Figures/HuRI_DMIs_OneMutation.tiff", units="cm", width=11, height=8, res=800)
p1
dev.off()
# SAVE PDF
pdf("Figures/ExtendedData_Figures/HuRI_DMIs_OneMutation.pdf", width=cm2in(11), height=cm2in(8))
p1
dev.off()

HURI_ClinVar_DMI_mut_count_DMI_long %>% filter(pathogenicity=="Uncertain") 
HURI_ClinVar_DMI_mut_count_DMI_long %>% filter(pathogenicity=="Uncertain" | pathogenicity=="Pathogenic") %>% select(-pathogenicity, -value) %>% unique()
HURI_ClinVar_DMI_mut_count_DMI_long %>% filter(pathogenicity=="Uncertain" | pathogenicity=="Pathogenic") %>% select(intx_ID) %>% unique()
HURI_ClinVar_DMI_mut_count_DMI_long %>% select(value) %>% sum()
HURI_ClinVar_DMI_mut_count_DMI_long %>% filter


# PPI with at least 1 variant
p2 <- ggplot(HURI_ClinVar_DMI_mut_count_DMI_long %>% select(intx_ID, pathogenicity) %>% unique(), 
             aes(y=pathogenicity, fill=pathogenicity)) + 
  geom_bar( width = 0.5) +
  xlab("PPI number") + ylab("Clinical relevance") + 
  theme_classic() + scale_fill_manual(values=colors_Var) + labs(fill = "Clinical relevance") +
  theme(text = element_text(size = 20), legend.position = "none", axis.text = element_text(color = "black"),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), axis.ticks = element_line(linewidth = 1)) + 
  scale_x_continuous(labels = scales::comma, limits = c(0,3000)) + scale_y_discrete(limits=rev) 
p2
p2 +  geom_text(aes(label = ..count..), stat = "count", vjust = -1, position = position_dodge(0.9), size = 3.5)

# SAVE TIFF
tiff("Figures/ExtendedData_Figures/HuRI_PPIs_OneMutation.tiff", units="cm", width=11, height=8, res=800)
p2
dev.off()

# SAVE PDF
pdf("Figures/ExtendedData_Figures/HuRI_PPIs_OneMutation.pdf", width=cm2in(11), height=cm2in(8))
p2
dev.off()

```

```{r ED_Figure1_Graphic_h_DMI_ClinVar_motif_categories}
#DMI - Motif variants

p1 <- ggplot(HURI_ClinVar_mut_motif, aes(y=ELM_type , fill=pathogenicity)) + 
  geom_bar(position="fill", width = 0.6, color="black", size=0.4) +
  xlab("Variant fraction") + ylab("Motif category") + 
  theme_minimal() + scale_fill_manual(values=colors_Var) + labs(fill = "Clinical relevance") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(),  axis.text = element_text(color = "black"), 
        legend.position = "none", panel.grid.minor = element_blank(),  axis.ticks = element_line(size = 0))+ 
  scale_y_discrete(limits=rev, labels = rev(elm_categories)) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 3)) 

p1
p1 +geom_text(aes(label = ..count..), stat = "count", vjust = -0.1,hjust= 1, position = position_fill(0.25), size = 3) +
  geom_text(stat='prop', vjust=-0.1, hjust= -0.1, position = position_fill(0.25), size=3) 

# SAVE TIFF
tiff("Figures/ExtendedData_Figures/HuRI_human_ClinVar_mutations_ELM.tiff", units="cm", width=11, height=8, res=800)
p1
dev.off()

# SAVE PDF
pdf("Figures/ExtendedData_Figures/HuRI_human_ClinVar_mutations_ELM.pdf", width=8, height=4)
p1
dev.off()


```



```{r Figure2_Graph_domains}
# Heatmap parameters
heatmap_pltt <- 'RdBu'
legend_t_size <- 15
legend_t_vjust <- 3
legend_tx_size <- 13
  
p1 <- ggplot(domain_BRET %>% filter(NL_symbol=="CTBP1"), aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_bret50  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("CTBP1 mutants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_text(hjust=0.3),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), plot.title = element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)  + 
  facet_grid2(category~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET )))
p1

p2 <- ggplot(domain_BRET %>% filter(NL_symbol=="CTBP1"),aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_cBRET )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("CTBP1 mutants") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_text(hjust=0.3),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), plot.title = element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)  + 
  facet_grid2(category~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET ))) + 
    guides(colour = guide_legend(title.position = "left"))
p2 

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/DomainValidation_CTBP1_BRET50.tiff", units="cm", width=12, height=8, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/DomainValidation_CTBP1_maxBRET.tiff", units="cm", width=12.3, height=8, res=800)
p2
dev.off()


p1 <- ggplot(domain_BRET %>% filter(NL_symbol=="SPOP"), aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_bret50  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("SPOP mutants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_text(hjust=0.5),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), plot.title = element_blank(),
        legend.key.height= unit(0.5, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[2:3] ))) 
p1

p2 <- ggplot(domain_BRET %>% filter(NL_symbol=="SPOP"), aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("SPOP mutants") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_text(hjust=0.5),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), plot.title = element_blank(),
        legend.key.height= unit(0.5, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[2:3] ))) 
p2

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/DomainValidation_SPOP_BRET50.tiff", units="cm", width=10, height=7.5, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/DomainValidation_SPOP_maxBRET.tiff", units="cm", width=10.3, height=7.5, res=800)
p2
dev.off()



p1 <- ggplot(domain_BRET %>% filter(NL_symbol=="WWOX"), aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_bret50  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("WWOX mutants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_text(hjust=0.3),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), plot.title = element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(category~., scales = "free_y", switch = "y", space = "free_y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET )))
p1

p2 <- ggplot(domain_BRET %>% filter(NL_symbol=="WWOX"), aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("WWOX mutants") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_text(hjust=0.3),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), plot.title = element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y",space = "free_y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET )))
p2


# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/DomainValidation_WWOX_BRET50.tiff", units="cm", width=11, height=11, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/DomainValidation_WWOX_maxBRET.tiff", units="cm", width=11.3, height=11, res=800)
p2
dev.off()


p1 <- ggplot(domain_BRET %>% filter(NL_symbol=="PPP3CA"), aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_bret50)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("PPP3CA mutants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_text(hjust=0.8),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), plot.title = element_blank(),
        legend.key.height= unit(0.5, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[c(1,3)] )))
p2 <- ggplot(domain_BRET %>% filter(NL_symbol=="PPP3CA"), aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_cBRET)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("PPP3CA mutants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_text(hjust=0.8),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), plot.title = element_blank(),
        legend.key.height= unit(0.5, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[c(1,3)] )))
p1
p2

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/DomainValidation_PPP3CA_BRET50.tiff", units="cm", width=10.5, height=7.5, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/DomainValidation_PPP3CA_maxBRET.tiff", units="cm", width=10.8, height=7.5, res=800)
p2
dev.off()



p1 <- ggplot(domain_BRET %>% filter(NL_symbol=="IQCB1") %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")) , 
             aes(NL_symbol, label, fill=tstat_bret50)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_blank(),
        plot.title = element_blank(),
        legend.key.height= unit(0.5, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(category~., scales = "free_y", switch = "y", space = "free_y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill = colors_BRET[2:3] )))

p2 <- ggplot(domain_BRET %>% filter(NL_symbol=="IQCB1") %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")) , 
             aes( NL_symbol, label,fill=tstat_cBRET)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_blank(),
        plot.title = element_blank(),
        legend.key.height= unit(0.5, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y",space = "free_y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill = colors_BRET[2:3] )))
p1
p2

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/DomainValidation_IQCB1_BRET50.tiff", units="cm", width=8.5, height=5.5, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/DomainValidation_IQCB1_maxBRET.tiff", units="cm", width=8.8, height=5.5, res=800)
p2
dev.off()


```

```{r Figure2_Graph_motifs}
# Heatmap parameters
heatmap_pltt <- 'RdBu'
legend_t_size <- 15
legend_t_vjust <- 3
legend_tx_size <- 13

theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_text(hjust=0.3),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), plot.title = element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +

p1 <- ggplot(motif_BRET %>% filter(NL_symbol=="CTBP1") %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol, fct_reorder2(label, as.numeric(residue), desc(mCit_symbol)), fill=tstat_bret50)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif deletions") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), 
        plot.title=element_text(size=12, hjust=0.95),
        legend.key.height= unit(0.5, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[2:3] ))) 

p2 <- ggplot(motif_BRET %>% filter(NL_symbol=="CTBP1") %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol, fct_reorder2(label, as.numeric(residue), desc(mCit_symbol)), fill=tstat_cBRET)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif deletions") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(),  
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(),
        plot.title=element_text(size=12, hjust=0.95),
        legend.key.height= unit(0.5, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[2:3] ))) 

p1
p2

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/MotifValidation_CTBP1_BRET50.tiff", units="cm", width=10, height=5.5, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/MotifValidation_CTBP1_maxBRET.tiff", units="cm", width=10.3, height=5.5, res=800)
p2
dev.off()


p1 <- ggplot(motif_BRET %>% filter(NL_symbol=="SPOP") %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol, fct_reorder(label, residue), fill=tstat_bret50)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif deletions") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), 
        plot.title=element_text(size=12, hjust=0.95),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size))+
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y", space = "free_y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[2:3] )))

p2 <- ggplot(motif_BRET %>% filter(NL_symbol=="SPOP") %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes( NL_symbol, fct_reorder(label, residue), fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif deletions") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(),  
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(),
        plot.title=element_text(size=12, hjust=0.95),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y", space = "free_y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[2:3] )))
p1
p2
# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/MotifValidation_SPOP_BRET50.tiff", units="cm", width=10, height=11, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/MotifValidation_SPOP_maxBRET.tiff", units="cm", width=10.3, height=11, res=800)
p2
dev.off()


p1 <- ggplot(motif_BRET %>% filter(NL_symbol=="WWOX") %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes( NL_symbol, fct_reorder(label, residue), fill=tstat_bret50  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif mutations") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), 
        plot.title=element_text(size=12, hjust=0.95),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size))+
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y", space = "free_y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[2:3] )))

p2 <- ggplot(motif_BRET %>% filter(NL_symbol=="WWOX") %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes( NL_symbol, fct_reorder(label, residue), fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif mutations") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(),  
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(),
        plot.title=element_text(size=12, hjust=0.95),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(category~., scales = "free_y", switch = "y", space = "free_y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[2:3] ))) 

p1
p2
# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/MotifValidation_WWOX_BRET50.tiff", units="cm", width=10, height=16, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/MotifValidation_WWOX_maxBRET.tiff", units="cm", width=10.3, height=16, res=800)
p2
dev.off()

p2 <- ggplot(motif_BRET %>% filter(NL_symbol=="WWOX") %>% filter(!(mCit_symbol=="LITAF" & residue>20)) %>%
               mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol,  fct_reorder(label, residue), fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif deletions") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(),
        axis.text.x = element_text(), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  facet_grid2(category~., scales = "free_y", switch = "y", space="free",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[2:3]  )))
p2

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/MotifValidation_WWOX_maxBRET_deletions.tiff", units="cm", width=10, height=9, res=800)
p2
dev.off()


p2 <- ggplot(motif_BRET %>% filter(NL_symbol=="WWOX") %>% filter(mCit_symbol=="LITAF" & residue>20) , 
             aes(NL_symbol, fct_reorder(canonical_mutation, residue),  fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("LITAF mutations") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(),  
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(),
        plot.title=element_text(size=12, hjust=0.95),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(category~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET[2:3] ))) 

p2
# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/MotifValidation_WWOX_maxBRET_LITAF.tiff", units="cm", width=8.8, height=9, res=800)
p2
dev.off()


p1 <- ggplot(motif_BRET %>% filter(NL_symbol=="IQCB1") %>% 
               mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(label, fct_reorder(fct_reorder2(mCit_symbol, residue, mCit_symbol), residue), fill=tstat_bret50)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(),
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x=element_blank(),
        axis.text.x = element_text(), plot.title=element_blank(),
        legend.key.height= unit(0.5, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(category~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET )))

p2 <- ggplot(motif_BRET %>% filter(NL_symbol=="IQCB1") %>% 
               mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")),
             aes(label, fct_reorder2(mCit_symbol, residue, mCit_symbol), fill=tstat_cBRET)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x=element_blank(),
        axis.text.x = element_text(), plot.title=element_blank(),
        legend.key.height= unit(0.5, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(category~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_BRET )))

p1
p2

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/MotifValidation_IQCB1_BRET50.tiff", units="cm", width=8, height=7.5, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/MotifValidation_IQCB1_maxBRET.tiff", units="cm", width=8.3, height=7.5, res=800)
p2
dev.off()

```

```{r Figure2_Graph_variants}
# Heatmap 
heatmap_pltt <- 'RdBu'
legend_t_size <- 15
legend_t_vjust <- 3
legend_tx_size <- 13

p1 <- ggplot(mutants_BRET %>% filter(NL_symbol=="CTBP1" & motif_variant==TRUE) %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol, fct_reorder2(label, residue, mCit_symbol), fill=tstat_bret50  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif variants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), 
        panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(ClinVar~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill ="#999999" )))

p2 <- ggplot(mutants_BRET %>% filter(NL_symbol=="CTBP1" & motif_variant==TRUE) %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol, fct_reorder2(label, residue, mCit_symbol), fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif variants") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(ClinVar~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill ="#999999" )))
                  
grid.arrange(p1, p2,nrow=1, left=textGrob("Motif variants", gp = gpar(fontsize = 20), rot=90 ))
p1
p2


# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_IQCB1_motif_BRET50.tiff", units="cm", width=9, height=8, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_IQCB1_motif_maxBRET.tiff", units="cm", width=9.3, height=8, res=800)
p2
dev.off()

p1 <- ggplot(mutants_BRET %>% filter(NL_symbol=="SPOP" & domain_variant==TRUE), 
             aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_bret50  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ggtitle("BRET50") +  theme_minimal() + labs(fill = "BRET50\neffect size") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), legend.position = "none",
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x=element_blank(),
        axis.text.x = element_blank(), plot.title=element_text(size=15, hjust=0.95)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(.~ClinVar, scales = "free_x", switch = "x", space = "free_x",
                 strip = strip_themed(text_x = element_text(size=0))) 

p2 <- ggplot(mutants_BRET %>% filter(NL_symbol=="SPOP" & domain_variant==TRUE) %>%
               mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(fct_reorder(label, residue), mCit_symbol, fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ggtitle("maxBRET") + theme_minimal() + labs(fill = "maxBRET\neffect size") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), legend.position = "none",
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x=element_blank(), 
        plot.title=element_text(size=15, hjust=0.95)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(.~ClinVar, scales = "free_x", switch = "x", space = "free_x",
                 strip = strip_themed(text_x = element_text(size=0),
                                     background_x = elem_list_rect( fill ="#d52221" )))

grid.arrange(p1, p2, nrow=2, bottom=textGrob("SPOP variant", gp = gpar(fontsize = 20)))

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_SPOP_domain.tiff", units="cm", width=5, height=12, res=800)
grid.arrange(p1, p2, heights=c(2,2.4), nrow=2)
dev.off()


p1 <- ggplot(mutants_BRET %>% filter(NL_symbol=="WWOX" & domain_variant==TRUE),
             aes(fct_reorder(canonical_mutation, residue),mCit_symbol, fill=tstat_bret50  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("WWOX variants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_text(hjust=0.5),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), plot.title = element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=c("DAZAP2", "CPSF6","LITAF" , "HOXA1","CSNK2B")) + 
  facet_grid2(.~ClinVar, scales = "free_x", switch = "x", space = "free_x",
                 strip = strip_themed(text_x = element_text(size=0),
                                     background_x = elem_list_rect( fill =colors_Var[3:4] ))) 
                 
p2 <- ggplot(mutants_BRET %>% filter(NL_symbol=="WWOX" & domain_variant==TRUE), 
             aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("WWOX variants") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x =  element_text(hjust=0.5),
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1), plot.title = element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=c("DAZAP2", "CPSF6","LITAF" , "HOXA1","CSNK2B")) + 
  facet_grid2(.~ClinVar, scales = "free_x", switch = "x", space = "free_x",
                 strip = strip_themed(text_x = element_text(size=0),
                                     background_x = elem_list_rect( fill =colors_Var[3:4] )))

grid.arrange(p1, p2, nrow=2, bottom=textGrob("WWOX variants", gp = gpar(fontsize = 20)))
p1
p2

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_WWOX_domain_BRET50.tiff", units="cm", width=11, height=9, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_WWOX_domain_maxBRET.tiff", units="cm", width=11.3, height=9, res=800)
p2
dev.off()


p1 <- ggplot(mutants_BRET %>% filter(NL_symbol=="WWOX" & motif_variant==TRUE) %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol, fct_reorder2(label, residue, mCit_symbol), fill=tstat_bret50  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif variants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), 
        panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(ClinVar~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill ="#999999" )))

p2 <- ggplot(mutants_BRET %>% filter(NL_symbol=="WWOX" & motif_variant==TRUE) %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol, fct_reorder2(label, residue, mCit_symbol), fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif variants") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), 
        panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  facet_grid2(ClinVar~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill ="#999999" )))
p1
p2


# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_WWOX_motif_BRET50.tiff", units="cm", width=9, height=12, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_WWOX_motif_maxBRET.tiff", units="cm", width=9.3, height=12, res=800)
p2
dev.off()


p1 <- ggplot(mutants_BRET %>% filter(NL_symbol=="WWOX" & motif_variant==TRUE) %>% 
               filter(!(mCit_symbol=="LITAF" & residue>20)) %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol, fct_reorder2(label, residue, mCit_symbol), fill=tstat_bret50  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif variants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), 
        panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(ClinVar~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill ="#999999" )))

p2 <- ggplot(mutants_BRET %>% filter(NL_symbol=="WWOX" & motif_variant==TRUE) %>% 
               filter(!(mCit_symbol=="LITAF" & residue>20)) %>% mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol, fct_reorder2(label, residue, mCit_symbol), fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Motif variants") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), 
        panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(ClinVar~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill ="#999999" )))

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_WWOX_motif_BRET50_oneLITAF.tiff", units="cm", width=9, height=8, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_WWOX_motif_maxBRET_oneLITAF.tiff", units="cm", width=9.3, height=8, res=800)
p2
dev.off()


p1 <- ggplot(mutants_BRET %>% filter(NL_symbol=="WWOX" & motif_variant==TRUE) %>% 
               filter(mCit_symbol=="LITAF" & residue>20), 
             aes(NL_symbol, fct_reorder2(canonical_mutation, residue, mCit_symbol), fill=tstat_bret50  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("LITAF variants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), 
        panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(ClinVar~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill ="#999999" )))

p2 <- ggplot(mutants_BRET %>% filter(NL_symbol=="WWOX" & motif_variant==TRUE) %>% 
               filter(mCit_symbol=="LITAF" & residue>20) , 
             aes(NL_symbol, fct_reorder2(canonical_mutation, residue, mCit_symbol), fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("LITAF variants") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), 
        panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(ClinVar~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill ="#999999" )))
p1
p2

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_WWOX_motif_BRET50_LITAF.tiff", units="cm", width=8.5, height=7, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_WWOX_motif_maxBRET_LITAF.tiff", units="cm", width=8.8, height=7, res=800)
p2
dev.off()

p1 <- ggplot(mutants_BRET %>% filter(NL_symbol=="WWOX" & motif_variant==TRUE) %>% 
               filter(mCit_symbol=="LITAF" & residue>20) %>% mutate(label=canonical_mutation), 
             aes(NL_symbol, fct_reorder2(label, residue, mCit_symbol), fill=tstat_bret50  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ggtitle("BRET50") +  theme_minimal() + labs(fill = "BRET50\neffect size") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), legend.position = "none",
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x=element_blank(), 
        plot.title=element_text(size=15, hjust=0.95)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(ClinVar~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill ="#999999" )))

p2 <- ggplot(mutants_BRET %>% filter(NL_symbol=="WWOX" & motif_variant==TRUE) %>% 
               filter(mCit_symbol=="LITAF" & residue>20) %>% mutate(label=canonical_mutation), 
             aes(NL_symbol, fct_reorder2(label, residue, mCit_symbol), fill=tstat_cBRET  )) +
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ggtitle("maxBRET") + theme_minimal() + labs(fill = "maxBRET\neffect size") +
  theme(text = element_text(size = 20), panel.grid.major = element_blank(), legend.position = "none",
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x=element_blank(),
        axis.text.y=element_blank(), plot.title=element_text(size=15, hjust=0.95)) +
  scale_y_discrete(limits=rev)+ 
  facet_grid2(ClinVar~., scales = "free_y", switch = "y",
                 strip = strip_themed(text_y = element_text(size=0)))
                
grid.arrange(p1, p2, nrow=1, left=textGrob("LITAF variants", gp = gpar(fontsize = 20), rot=90 ))

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_WWOX_motif_LITAF2.tiff", units="cm", width=7.5, height=6.5, res=800)
grid.arrange(p1, p2, nrow=1, widths=c(3,2), left=textGrob("LITAF variants", gp = gpar(fontsize = 20), rot=90 ))
dev.off()


# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_PPP3CA_motif.tiff", units="cm", width=7, height=7, res=800)
grid.arrange(p1, p2, nrow=2, heights=c(2,2.4), left=textGrob("Motif variant", gp = gpar(fontsize = 20), rot=90 ))
dev.off()
# # SAVE TIFF
# tiff("Figures/Figure3_graphics/Heatmaps/VariantTest_PPP3CA_motif.tiff", units="cm", width=9, height=8, res=800)
# grid.arrange(p1, p2, nrow=2, left=textGrob("Motif variant", gp = gpar(fontsize = 20), rot=90 ))
# dev.off()



p1 <- ggplot(mutants_BRET %>% filter(NL_symbol=="IQCB1" & motif_variant==TRUE) %>% 
               mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol, fct_reorder(label,  mCit_symbol),  fill=tstat_bret50)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Domain variants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), 
        panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(ClinVar~., scales = "free_y", switch = "y", space = "free_y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_Var[3:4] )))

p2 <- ggplot(mutants_BRET %>% filter(NL_symbol=="IQCB1" & motif_variant==TRUE) %>% 
               mutate(label=paste(gene_symbol,canonical_mutation, sep="\n")), 
             aes(NL_symbol, fct_reorder(label,  mCit_symbol), fill=tstat_cBRET  )) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ylab("Domain variants") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), 
        panel.grid.major = element_blank(), 
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.x=element_blank(), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(ClinVar~., scales = "free_y", switch = "y", space = "free_y",
                 strip = strip_themed(text_y = element_text(size=0),
                                     background_y = elem_list_rect( fill =colors_Var[3:4] )))
p1
p2

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_IQCB1_domain_BRET50.tiff", units="cm", width=9, height=12, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_IQCB1_domain_maxBRET.tiff", units="cm", width=9.3, height=12, res=800)
p2
dev.off()


p1 <- ggplot(mutants_BRET %>% filter(NL_symbol=="IQCB1" & domain_variant==TRUE) %>% 
               mutate(residue=as.numeric(gsub("[A-Z]", "", canonical_mutation))), 
             aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_bret50)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_BRET50), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("IQCB1 variants") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(text = element_text(size = 20), 
        panel.grid.major = element_blank(),
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x=element_text(hjust=0.8),
         axis.text.x = element_text(angle = 30, vjust = 1.1, hjust=1), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(.~ClinVar, scales = "free_x", switch = "x", space = "free_x",
                 strip = strip_themed(text_x = element_text(size=0),
                                     background_x = elem_list_rect( fill ="#999999" )))

p2 <- ggplot(mutants_BRET %>% filter(NL_symbol=="IQCB1" & domain_variant==TRUE) %>% 
               mutate(residue=as.numeric(gsub("[A-Z]", "", canonical_mutation))) , 
             aes(fct_reorder(canonical_mutation, residue), mCit_symbol, fill=tstat_cBRET)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  xlab("IQCB1 variants") + theme_minimal() + labs(fill = "Effect size\n\u0394maxBRET") +
  theme(text = element_text(size = 20), 
        panel.grid.major = element_blank(),
        axis.text = element_text(color = "black"), panel.grid.minor = element_blank(), 
        axis.ticks = element_line(size = 0), axis.title.y=element_blank(), axis.title.x=element_text(hjust=0.8),
         axis.text.x = element_text(angle = 30, vjust = 1.1, hjust=1), plot.title=element_blank(),
        legend.key.height= unit(0.7, 'cm'), legend.key.width= unit(0.25, 'cm'), 
        legend.title = element_text(size=legend_t_size, vjust=legend_t_vjust), legend.text = element_text(size=legend_tx_size)) +
  scale_y_discrete(limits=rev) + 
  facet_grid2(.~ClinVar, scales = "free_x", switch = "x", space = "free_x",
                 strip = strip_themed(text_x = element_text(size=0),
                                     background_x = elem_list_rect( fill ="#999999" )))
p1
p2

# SAVE TIFF
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_IQCB1_motif_BRET50.tiff", units="cm", width=9.5, height=8, res=800)
p1
dev.off()
tiff("/Users/jesusav/Desktop/Heatmaps/VariantTest_IQCB1_motif_maxBRET.tiff", units="cm", width=9.8, height=8, res=800)
p2
dev.off()

p_legend <- ggplot(mutants_BRET %>% filter(NL_symbol=="IQCB1" & domain_variant==TRUE) %>% 
               mutate(residue=as.numeric(gsub("[A-Z]", "", canonical_mutation))) , 
             aes(mCit_symbol, fct_reorder(canonical_mutation, residue), fill=tstat_cBRET)) + 
  geom_tile(color = "white", lwd = 1.2) + geom_text(aes(label=sig_maxBRET), size=7) +
  scale_fill_continuous_divergingx(palette = heatmap_pltt, rev = TRUE, mid = 0, limits = c(-20, 20), na.value = "grey80")+
  ggtitle("maxBRET") + theme_minimal() + labs(fill = "Effect size\n\u0394BRET50") +
  theme(legend.key.height= unit(1, 'cm'), legend.key.width= unit(0.5, 'cm'), 
        legend.title = element_text(size=20, vjust=5), legend.text = element_text(size=20))

p_legend
```

```{r Figure2_Graph_titrationPlots}
for(i in 1:nrow(BRET_mutant_pairs)){
  pair_info <- BRET_mutant_pairs[i,] %>% unlist() %>% as.vector()
  
  project <- pair_info[1]
  NL <- pair_info[2]
  mCIT <- pair_info[3]
  
  plot_data <- BRET_values_info %>% filter(project_id==project & NL_plasmid_id==NL & mCit_plasmid_id==mCIT & test=="mutant")
  WT_data <-  BRET_values_info %>% filter(project_id==project & NL_protein==pair_info[7] & mCit_protein==pair_info[8] & test=="WT")
  plot_data <- rbind(plot_data, WT_data)
  
  plot_title <- paste(gsub(" ([0-9]{1,3}del)", "-\\1", gsub("_", " ", pair_info[5])), 
                      gsub(" ([0-9]{1,3}del)", "-\\1", gsub("_", " ", pair_info[6])), sep=" - ")
  if(pair_info[4]=="BRET50"){
    test_label <- "BRET50"
    
    plot_fit <- BRET_fits %>% filter(project_id==project & NL_plasmid_id==NL & mCit_plasmid_id==mCIT)%>% mutate(test="mutant")
    WT_fit <-  BRET_fits %>% filter(project_id==project & NL_plasmid_id==unlist(WT_data$NL_plasmid_id[1]) &
                                      mCit_plasmid_id==unlist(WT_data$mCit_plasmid_id[1])) %>% mutate(test="WT")
    plot_fit <- rbind(plot_fit, WT_fit)
    
    plot_fit_data <- tibble(repl_id=character(), cBRET=double(), ratio=double(), test=character()) 
    # cBRET = bret_max * expr_ratio / (bret50 + expr_ratio)
    for(i in 1:nrow(plot_fit)){
      line_info <- plot_fit[i,] %>% unlist() %>% as.vector()
      
      line_test <- line_info[10]
      replicate_id <- line_info[4]
      bret50 <- as.numeric(line_info[5])
      bretmax <-  as.numeric(line_info[7])
      
      expr_ratio_max <- plot_data %>% filter(repl_id==replicate_id & test==line_test) %>% select(ratio) %>% max()
      
      expr_ratio_line <- seq(0, expr_ratio_max, by = expr_ratio_max/100)
      cBRET_line <- bretmax * expr_ratio_line / (bret50 + expr_ratio_line)
      
      plot_fit_line <- tibble(repl_id=replicate_id, cBRET=cBRET_line, ratio=expr_ratio_line, test=line_test) 
      plot_fit_data <- rbind(plot_fit_data, plot_fit_line)
    }

  p <- ggplot() + geom_point(data=plot_data, size=2.2, aes(x=ratio, y = cBRET, color=test) ) + 
      geom_line(data=plot_fit_data, size=0.8, aes(x=ratio, y = cBRET, group=interaction(test, repl_id), color=test))+
      ggtitle(plot_title) +  ylab("BRET") + xlab("Protein Acc/Don") +
      #annotate(geom="text", label=test_label, x=max(plot_data$ratio)*0.9, y=max(plot_data$cBRET)/3, size=3, color="red")+
      theme_classic() + labs(fill = "Pathogenicity") + scale_color_manual(values=c("#d52221","black")) +
      theme(text = element_text(size = 18), axis.text = element_text(color = "black"), legend.position="none", 
            plot.title= element_text(size = 13), axis.ticks = element_line(linewidth = 1)) +
      scale_x_continuous(breaks = scales::pretty_breaks(n = 2)) + 
      scale_y_continuous(labels = function(x) number(x, accuracy = 0.1), 
                         breaks = scales::pretty_breaks(n = 3), limits=c(0,max((plot_data$cBRET))*1.1))
  
  file_name <- paste("/Users/jesusav/Desktop/Titrations/",pair_info[5],"_",pair_info[6],".tiff",sep="")
    tiff(file_name, units="cm", width=8, height=6, res=800)
    print(p)
    dev.off()
    
    
  } 
  else if(pair_info[4]=="maxBRET"){
    test_label <- "maxBRET"
    
    p <- ggplot(plot_data, aes(x=ratio, y = cBRET, color=test) ) + 
      geom_point(size=2.2) +
      ggtitle(plot_title) +  ylab("BRET") + xlab("Protein Acc/Don") +
      #annotate(geom="text", label=test_label, x=max(plot_data$ratio)*0.9, y=max(plot_data$cBRET)/3, size=3, color="red")+
      theme_classic() + labs(fill = "Pathogenicity") + scale_color_manual(values=c("#d52221","black")) +
      theme(text = element_text(size = 18), axis.text = element_text(color = "black"), legend.position="none", 
            plot.title= element_text(size = 13), axis.ticks = element_line(linewidth = 1)) +
      scale_x_continuous(breaks = scales::pretty_breaks(n = 2)) + 
      scale_y_continuous(labels = function(x) number(x, accuracy = 0.1), 
                         breaks = scales::pretty_breaks(n = 3), limits=c(0,max((plot_data$cBRET))*1.1)) 
    
  file_name <- paste("/Users/jesusav/Desktop/Titrations/",pair_info[5],"_",pair_info[6],".tiff",sep="")
    tiff(file_name, units="cm", width=8, height=6, res=800)
    print(p)
    dev.off()
    
    
  } 
  
  
  
  
}

#BRET_results %>% filter(NL_symbol=="CTBP1" & mCit_symbol=="IKZF1") %>% arrange(project_id) %>% select(NL_plasmid, mCit_plasmid, tstat_bret50, tstat_cBRET, sig_BRET50, sig_maxBRET)
```



```{r Figure4_Graphic_a_c_Motif_regions_scores}
p1 <- ggplot(BRET_mutants_update_motif, aes(x=mutation_location, y=pLDDT)) + 
  geom_quasirandom(size=2, alpha=1, aes(color=mutation_location)) + #geom_beeswarm(corral = "wrap", alpha=0.2, size=0.1) + 
  geom_boxplot(color="black", alpha=0.1, width=0.5, lwd=0.4, outlier.size = 1, outlier.alpha = 1) + 
  geom_hline(yintercept = 80, color="red") + ylim(25,100) + scale_color_manual(values=c("forestgreen","limegreen")) +
  ggtitle("BRET motif mut") +  xlab("Motif region") + ylab("Residue pLDDT") + 
  theme_classic() + 
  theme(text = element_text(size = 18), legend.position="none", axis.text = element_text(color = "black")) +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 3)) 

p2 <- ggplot(BRET_mutants_update_motif, aes(x=mutation_location, y=RSA)) + 
  geom_quasirandom(size=2, alpha=1, aes(color=mutation_location)) + #geom_beeswarm(corral = "wrap", alpha=0.2, size=0.1) + 
  geom_boxplot(color="black", alpha=0.1, width=0.5, lwd=0.4, outlier.size = 1, outlier.alpha = 1) + 
  geom_hline(yintercept = 0.25, color="red") + ylim(0,1) + scale_color_manual(values=c("forestgreen","limegreen")) +
  ggtitle("BRET motif mut") +  xlab("Motif region") + ylab("Residue RSA") + 
  theme_classic() + 
  theme(text = element_text(size = 18), legend.position="none", axis.text = element_text(color = "black")) +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 3)) 

p3 <- ggplot(BRET_mutants_update_motif, aes(x=mutation_location, y=deltaRSA)) + 
  geom_quasirandom(size=2, alpha=1, aes(color=mutation_location)) + #geom_beeswarm(corral = "wrap", alpha=0.2, size=0.1) + 
  geom_boxplot(color="black", alpha=0.1, width=0.5, lwd=0.4, outlier.size = 1, outlier.alpha = 1) + 
  geom_hline(yintercept = -0.05, color="red") + ylim(-1,0) + scale_color_manual(values=c("forestgreen","limegreen")) +
  ggtitle("BRET motif mut") +  xlab("Motif region") + ylab("Residue \u0394 RSA") + 
  theme_classic() + 
  theme(text = element_text(size = 18), legend.position="none", axis.text = element_text(color = "black")) +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 3)) 

grid.arrange(p1, p2, p3,  nrow=1)

# SAVE TIFF
tiff("Figures/Figure4_graphics/BRET_mutants_scores.tiff", units="cm", width=18, height=8, res=800)
grid.arrange(p1, p2, p3,  nrow=1)
dev.off()

# SAVE PDF
pdf("Figures/Figure4_graphics/BRET_mutants_scores.pdf", width=cm2in(18), height=cm2in(8))
grid.arrange(p1, p2, p3,  nrow=1)
dev.off()
cairo_pdf("/Users/jesusav/Desktop/Figure4_graphics/BRET_mutants_scores_cairo.pdf", width=cm2in(18), height=cm2in(8))
grid.arrange(p1, p2, p3,  nrow=1)
dev.off()


```

```{r Figure4_Graphic_b_BRET_motif_regions}

BRET_mutants_update_motif$exp_conclusion <- ordered(BRET_mutants_update_motif$exp_conclusion, levels = c("disrupting","not_disrupting"))


p1 <- ggplot(BRET_mutants_update_motif, aes(x=mutation_location, y=tstat_bret50)) + 
  geom_quasirandom(size=2, alpha=1, aes(color=exp_conclusion)) + #geom_beeswarm(corral = "wrap", alpha=0.2, size=0.1) + 
  geom_boxplot(color="black", alpha=0.1, width=0.5, lwd=0.4, outlier.size = 0.5, outlier.alpha = 1) + 
  scale_color_manual(values=c("#00548C","#56B4E9")) +
  xlab("Group") + ylab("Effect size \u0394BRET50") +  ylim(-25,5) +
  theme_classic() + 
  theme(text = element_text(size = 20), legend.position="none", axis.text = element_text(color = "black"), 
         axis.title.x=element_blank(), plot.title=element_blank())  +
  scale_x_discrete(labels = c("Core","Flank","Core","Flank")) 

p2 <- ggplot(BRET_mutants_update_motif, aes(x=mutation_location, y=tstat_cBRET)) + 
  geom_quasirandom(size=2, alpha=1, aes(color=exp_conclusion)) + #geom_beeswarm(corral = "wrap", alpha=0.2, size=0.1) + 
  geom_boxplot(color="black",  alpha=0.1,  width=0.5, lwd=0.4, outlier.size = 0.5, outlier.alpha = 1) + 
  scale_color_manual(values=c("#00548C","#56B4E9")) +
  xlab("Group") + ylab("Effect size \u0394maxBRET") + ylim(-25,5) +
  theme_classic() + 
  theme(text = element_text(size = 20), legend.position="none", axis.text = element_text(color = "black"), 
        axis.title.x=element_blank(), plot.title=element_blank() ) +
  scale_x_discrete(labels = c("Core","Flank","Core","Flank")) 

grid.arrange(p1, p2,  widths=c(6,5), nrow=1)

# SAVE TIFF
tiff("Figures/Figure4_graphics/BRET_mutants_scores_BRET2.tiff", units="cm", width=11, height=8, res=800)
grid.arrange(p1, p2 , widths=c(6,5),  nrow=1)
dev.off()
# SAVE PDF
tiff("Figures/Figure4_graphics/BRET_mutants_scores_BRET2.pdf", width=cm2in(11), height=cm2in(8))
grid.arrange(p1, p2 , widths=c(6,5),  nrow=1)
dev.off()

# SAVE TIFF
tiff("Figures/Figure4_graphics/BRET_mutants_scores_BRET50_2.tiff", units="cm", width=7, height=8, res=800)
p1 
dev.off()
# SAVE PDF
tiff("Figures/Figure4_graphics/BRET_mutants_scores_BRET50_2.pdf", width=cm2in(7), height=cm2in(8))
p1 
dev.off()

# SAVE TIFF
tiff("Figures/Figure4_graphics/BRET_mutants_scores_maxBRET_2.tiff", units="cm", width=7, height=8, res=800)
p2 
dev.off()
# SAVE PDF
tiff("Figures/Figure4_graphics/BRET_mutants_scores_maxBRET_2.pdf",  width=cm2in(7), height=cm2in(8))
p2 
dev.off()



```

```{r Figure4_Graphic_e_BRET_structural_regions}
BRET_mutants_update$exp_conclusion <- ordered(BRET_mutants_update$exp_conclusion, levels = c("disrupting","not_disrupting"))
p1 <- ggplot(BRET_mutants_update , aes(x=structural_region, y=tstat_bret50)) + 
  geom_quasirandom(size=2, alpha=1, aes(color=exp_conclusion)) + #geom_beeswarm(corral = "wrap", alpha=0.2, size=0.1) + 
  geom_boxplot(color="black", alpha=0.1, width=0.5, lwd=0.4, outlier.size = 1, outlier.alpha = 1) + 
  scale_color_manual(values=c("#00548C","#56B4E9")) +
  xlab("Group") + ylab("Effect size \u0394BRET50") +  ylim(-25,5) +
  theme_classic() + 
  theme(text = element_text(size = 18), legend.position="none", axis.text = element_text(color = "black"), 
        axis.title.x=element_blank(), plot.title=element_blank(), 
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1)) +
  scale_x_discrete(labels = strc_categories) 

p2 <- ggplot(BRET_mutants_update , aes(x=structural_region, y=tstat_cBRET)) + 
  geom_quasirandom(size=2, alpha=1, aes(color=exp_conclusion)) + #geom_beeswarm(corral = "wrap", alpha=0.2, size=0.1) + 
  geom_boxplot(color="black", alpha=0.1, width=0.5, lwd=0.4, outlier.size = 1, outlier.alpha = 1) + 
  scale_color_manual(values=c("#00548C","#56B4E9")) +
  xlab("Group") + ylab("Effect size \u0394maxBRET") +  ylim(-25,5) +
  theme_classic() + 
  theme(text = element_text(size = 18), legend.position="none", axis.text = element_text(color = "black"), 
        axis.title.x= element_blank(), plot.title=element_blank(), 
        axis.text.x = element_text(angle = 30, vjust = 1, hjust=1) ) +
  scale_x_discrete(labels = strc_categories) 
grid.arrange(p1, p2, nrow=1)


# SAVE TIFF
tiff("Figures/Figure4_graphics/BRET_mutants_regions_BRET.tiff", units="cm", width=15, height=9, res=800)
grid.arrange(p1, p2+ theme(axis.title=element_blank(),axis.text.y = element_blank()), widths=c(7,6), nrow=1)
dev.off()
# SAVE TIFF
tiff("Figures/Figure4_graphics/BRET_mutants_regions_BRET.pdf", width=cm2in(15), height=cm2in(9))
grid.arrange(p1, p2+ theme(axis.title=element_blank(),axis.text.y = element_blank()), widths=c(7,6), nrow=1)
dev.off()


# SAVE TIFF
tiff("Figures/Figure4_graphics/BRET_mutants_regions_BRET50.tiff", units="cm", width=10, height=9, res=800)
p1
dev.off()
# SAVE TIFF
tiff("Figures/Figure4_graphics/BRET_mutants_regions_BRET50.pdf", width=cm2in(10), height=cm2in(9))
p1
dev.off()

# SAVE TIFF
tiff("Figures/Figure4_graphics/BRET_mutants_regions_BRET50.tiff", units="cm", width=10, height=9, res=800)
p1
dev.off()
# SAVE TIFF
tiff("Figures/Figure4_graphics/BRET_mutants_regions_BRET50.pdf", width=cm2in(10), height=cm2in(9))
p1
dev.off()

temp <- ggplot(BRET_mutants_update , aes(x=structural_region, y=tstat_cBRET)) + 
  geom_quasirandom(size=2, alpha=1, aes(color=exp_conclusion)) + #geom_beeswarm(corral = "wrap", alpha=0.2, size=0.1) + 
  geom_boxplot(color="black", alpha=0.1, width=0.5, lwd=0.4, outlier.size = 1, outlier.alpha = 1) + 
  scale_color_manual(values=c("#00548C","#56B4E9"),labels=c( "Disrupting","Not-disrupting")) +
  xlab("Group") + ylab("Effect size \u0394maxBRET") +  ylim(-25,5) +
  theme_classic() + theme(legend.key.size = unit(1, 'cm'), legend.text = element_text(size=20))+
  guides(colour = guide_legend(override.aes = list(size=5)))


BRET_mutants_update %>% 
  select(mut_protein, aa_change, ClinVar, exp_conclusion, fragment_variant) %>% unique() %>%
  filter(exp_conclusion=="disrupting" & ClinVar=="Uncertain") %>% unique()

grid.draw(cowplot::get_legend(temp))
# SAVE TIFF
tiff("Figures/Figure4_graphics/bret_point_legend.tiff", units="cm", width=7, height=4, res=800)
grid.draw(cowplot::get_legend(temp))
dev.off()
# SAVE PDF
pdf("Figures/Figure4_graphics/bret_point_legend.pdf", width=cm2in(7), height=cm2in(4))
grid.draw(cowplot::get_legend(temp))
dev.off()

```

```{r Figure4_Graphic_f_AM_structural_regions}
p1 <- ggplot(BRET_mutants_update %>% select(aa_change, structural_region, exp_conclusion,AlphaMissense) %>% unique(), 
             aes(y=structural_region, fill=AlphaMissense)) + 
  geom_bar(position="fill", width = 0.6, color="black", size=0.4) +
  ylab("Structural region") + xlab("Variant fraction") + 
  theme_minimal() + scale_fill_manual(values=colors_Var) + labs(fill = "AlphaMissense") +
  theme(text = element_text(size = 20),  panel.grid.minor = element_blank(), legend.position="none",
        axis.ticks = element_line(size = 0.5), panel.grid.major = element_blank(), 
        axis.ticks.y = element_blank(), axis.text = element_text(color = "black"))   + 
  scale_y_discrete(limits=rev, labels = rev(strc_categories)) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 3)) 

p1 +  geom_text(aes(label = ..count..), stat = "count", vjust = -0.1,hjust= 1, position = position_fill(0.25), size = 3) +
  geom_text(stat='prop', vjust=-0.1, hjust= -0.1, position = position_fill(0.25), size=3) 

# SAVE TIFF
tiff("Figures/Figure4_graphics/BRET_mutants_AM_2.tiff", units="cm", width=11, height=8, res=800)
p1
dev.off()

# SAVE PDF
pdf("Figures/Figure4_graphics/BRET_mutants_AM_2.pdf",  width=cm2in(11), height=cm2in(8))
p1
dev.off()


BRET_mutants_update %>% filter(structural_region=="m_interface")

p_legend <- ggplot(BRET_mutants_update %>% select(aa_change, structural_region, exp_conclusion,AlphaMissense) %>% unique(), 
             aes(y=structural_region, fill=AlphaMissense)) + 
  geom_bar(position="fill", width = 0.6, color="black", size=0.4) +
  ylab("Structural region") + xlab("Variant fraction") + 
  theme_minimal()  +  scale_fill_manual(values=colors_Var, guide = guide_legend(theme = theme(
      legend.direction = "horizontal", legend.title = element_text(size=18), legend.text = element_text(size=18)))) + 
  labs(fill = "AlphaMissense") + guides(col = guide_legend(ncol = 3))

grid.draw(cowplot::get_legend(p_legend))
# SAVE TIFF
tiff("Figures/Figure4_graphics/AM_horizontal_legend.tiff", units="cm", width=16, height=2, res=800)
grid.draw(cowplot::get_legend(p_legend))
dev.off()
# SAVE PDF
pdf("Figures/Figure4_graphics/AM_horizontal_legend.pdf", width=cm2in(16), height=cm2in(2))
grid.draw(cowplot::get_legend(p_legend))
dev.off()

p_legend <- ggplot(BRET_mutants_update, aes(y=structural_region, fill=as.factor(exp_conclusion))) + 
  geom_bar(position="fill", width = 0.6, color="black", size=0.4) +
  ylab("Structural region") + xlab("Fraction DMIs perturbed") + 
  theme_minimal() + scale_fill_manual(values=c("#CADCE8","#00548C")) + labs(fill = "Interaction")

p_legend +  scale_fill_manual(values=c("#00548C","#CADCE8"),  labels=c( "Disrupting","Not-disrupting"), guide = guide_legend(theme = theme(
      legend.direction = "horizontal", legend.title = element_text(size=20), legend.text = element_text(size=20)))) + 
  labs(fill = "Conclusion") + guides(col = guide_legend(ncol = 3)) + scale_y_discrete(limits=rev)

p_legend <- ggplot(BRET_mutants_update %>% select(aa_change, structural_region, exp_conclusion, ClinVar) %>% unique(), 
             aes(y=structural_region, fill=ClinVar)) + 
  geom_bar(position="fill", width = 0.6, color="black", size=0.4) +
  ylab("Structural region") + xlab("Variant fraction") + 
  theme_minimal() + scale_fill_manual(values=colors_Var[3:4]) + labs(fill = "ClinVar")

p_legend +  scale_fill_manual(values=colors_Var[3:4], guide = guide_legend(theme = theme(
      legend.direction = "vertical", legend.title = element_text(size=20), legend.text = element_text(size=20)))) + 
  labs(fill = "ClinVar") + guides(col = guide_legend(ncol = 3))




```



```{r Figure5_Graphic_a_DMI_AF_scores}
p1 <- ggplot(scores_count, aes(x=bin, y=count_dmi)) +  geom_line() + 
  annotate(geom="text", label="0.6", x=0.68, y=6000, size=5, color="red")+ 
  geom_vline(xintercept = 0.6, size=0.5, color="red") + 
  ggtitle("DMI AF models scores") + xlab("Model confidence") + ylab("Model count") + 
  theme_classic() + 
  theme(text = element_text(size = 20), axis.text = element_text(color = "black"), axis.ticks = element_line(linewidth = 1)) + 
  scale_y_continuous(labels = scales::comma, limits = c(0,8000)) 

p1 + geom_point() +
  annotate(geom="text", label="Step = 0.05", x=0.2, y=4000, size=3.5)+
  geom_text(aes(label = count_dmi), vjust = -1, hjust = -0.2, size = 3) 

# SAVE TIFF
tiff("Figures/Figure5_graphics/ModelScore_cummulative.tiff", units="cm", width=10, height=8, res=800)
p1
dev.off()

# SAVE PDF
pdf("Figures/Figure5_graphics/ModelScore_cummulative.pdf", width=cm2in(10), height=cm2in(8))
p1
dev.off()

p2 <- ggplot(scores_count, aes(x=bin, y=count_ppi)) +  geom_line() + 
  annotate(geom="text", label="0.6", x=0.68, y=1900, size=5, color="red")+ 
  geom_vline(xintercept = 0.6, size=0.5, color="red") + 
  ggtitle("DMI AF models scores") + xlab("Model confidence") + ylab("PPI count") + 
  theme_classic() + 
  theme(text = element_text(size = 20), axis.text = element_text(color = "black"), axis.ticks = element_line(linewidth = 1)) + 
  scale_y_continuous(labels = scales::comma, limits = c(0,2100)) 

p2 + geom_point() +
  annotate(geom="text", label="Step = 0.05", x=0.2, y=4000, size=3.5)+
  geom_text(aes(label = count_ppi), vjust = -1, hjust = -0.2, size = 3) 
  
# SAVE TIFF
tiff("Figures/SuppFig_AFmodels_graphics/ModelScore_cummulative_PPI.tiff", units="cm", width=10, height=8, res=800)
p2
dev.off()

# SAVE PDF
pdf("Figures/SuppFig_AFmodels_graphics/ModelScore_cummulative_PPI.pdf", width=cm2in(10), height=cm2in(8))
p2
dev.off()

coeff <-  max(scores_count$count_ppi) /max(scores_count$count_dmi)

p3 <- ggplot(scores_count, aes(x=bin)) +  geom_line( aes(y=count_dmi), size=1) + geom_line( aes(y=count_ppi / coeff)) + 
  annotate(geom="text", label=c("0.6","DMI","PPI"), x=c(0.68,0.3,0.45), y=c(7700,6400,7600), size=5, color=c("red","black","black") )+ 
  geom_vline(xintercept = 0.6, size=0.5, color="red") + 
  ggtitle("AF DMI scores") + xlab("Model confidence score") +
  theme_classic() + 
  theme(text = element_text(size = 20), axis.text = element_text(color = "black"), axis.ticks = element_line(linewidth = 1))+ 
  scale_y_continuous(labels = scales::comma, , limits = c(0,8000), name = "DMI model count", sec.axis = sec_axis(~.*coeff, name="PPI count"))
p3

# SAVE TIFF
tiff("Figures/SuppFig_AFmodels_graphics/DMIScore_cummulative_DMI_PPI.tiff", units="cm", width=12, height=8, res=800)
p3
dev.off()

# SAVE PDF
pdf("Figures/SuppFig_AFmodels_graphics/DMIScore_cummulative_DMI_PPI.pdf", width=cm2in(12), height=cm2in(8))
p3
dev.off()

```

```{r Figure5_Graphic_b_DMI_AF_ClinVar_structural_regions}
# Variants mapped
p1 <- ggplot(DMI_AF_mut_hq %>% filter(structural_region!="other"), aes(y=structural_region, fill=Pathogenicity)) + 
  geom_bar(position="fill", width = 0.6, color="black", size=0.4) +
  xlab("Variant fraction") + ylab("Structural region") + 
  theme_minimal() + scale_fill_manual(values=colors_Var) + labs(fill = "Pathogenicity") +
  theme(text = element_text(size = 20), legend.position = "none", axis.text = element_text(color = "black"),
        axis.ticks = element_line(size = 0.5), panel.grid.major = element_blank(), 
        axis.ticks.y = element_line(size = 0), panel.grid.minor = element_blank())  + 
  scale_y_discrete(limits=rev, labels = rev(strc_categories)) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 3)) 

p1 +  geom_text(aes(label = ..count..), stat = "count", vjust = -0.1,hjust= 0.5, position = position_fill(0.25), size = 3) +
  geom_text(stat='prop', vjust=-0.1, hjust= -1, position = position_fill(0.25), size=3) 

# SAVE TIFF
tiff("Figures/Figure5_graphics/ClinVar_modelRegion_RSA25.tiff", units="cm", width=11, height=8, res=800)
p1
dev.off()

# SAVE PDF
pdf("Figures/Figure5_graphics/ClinVar_modelRegion.pdf",  width=cm2in(11), height=cm2in(8))
p1
dev.off()



DMI_AF_mut_hq %>% count(structural_region, Pathogenicity)
```

```{r Figure5_Graphic_c_DMI_AF_ClinVar_AM_interfacial}
#https://r-graph-gallery.com/322-custom-colours-in-sankey-diagram.html
i <- 3
SK3 <- DMI_AF_mut_mapped %>% filter(structural_region==regions[[i]])# %>% select(-structural_region)
p3 <- sankeyNetwork(Links = SK3, Nodes = nodes, colourScale=my_color, NodeGroup="group",
              Source = "ClinVar", Target = "AlphaMissence",
              Value = "value", NodeID = "name", sinksRight=FALSE, 
              nodeWidth=50, nodePadding=30, fontSize=0.01, fontFamily = 'Helvetica',
              height = 500, width = 500)

saveNetwork(p3, file = 'Figures/Figure5_graphics/Region_domain_interface.html')
# SAVE PDF
pdf("Figures/Figure5_graphics/Region_domain_interface.pdf", width=cm2in(10), height=cm2in(8))
grid.p3
dev.off()


i <- 5
SK5 <- DMI_AF_mut_mapped %>% filter(structural_region==regions[[i]]) %>% select(-structural_region)
p5 <- sankeyNetwork(Links = SK5, Nodes = nodes, colourScale=my_color, NodeGroup="group",
              Source = "ClinVar", Target = "AlphaMissence",
              Value = "value", NodeID = "name", sinksRight=FALSE, 
              nodeWidth=50, nodePadding=30, fontSize=0.01, fontFamily = 'Helvetica',
              height = 500, width = 500)

p5
saveNetwork(p5, file = 'Figures/Figure6_graphics/Region_motif_interface.html')


```



```{r ED_Figure3_Graphic_c_DMI_AF_motif_categories}
# Highscored DMI by category
p1 <- ggplot(DMI_AF_metrics  %>% filter(model_score>=0.6), aes(y=ELM_type, fill=ELM_type)) + geom_bar(width = 0.5) +
  xlab("DMI number") + ylab("ELM category") + 
  theme_classic() + scale_fill_manual(values=colors_ELMtypes[c(1:4,6)]) + labs(fill = "ELM category") +
  theme(text = element_text(size = 20), legend.position = "none", axis.text = element_text(color = "black"), 
        axis.ticks = element_line(linewidth = 1), axis.text.x = element_text(angle = 30, vjust = 1, hjust=1))  + 
  scale_x_continuous(labels = scales::comma, limits = c(0,2600)) + 
  scale_y_discrete(limits=rev, labels = rev(elm_categories[c(1:4,6)])) 
p1 +  geom_text(aes(label = ..count..), stat = "count", vjust = -1, position = position_dodge(0.9), size = 3.5)

# SAVE TIFF
tiff("Figures/Figure5_graphics/AF_high_DMIs.tiff", units="cm", width=10, height=7, res=800)
p1
dev.off()

# SAVE PDF
pdf("Figures/Figure5_graphics/AF_high_DMIs.pdf", width=4, height=3)
p1
dev.off()

#"PPI with at least 1 DMI category"
p2 <- ggplot(DMI_AF_class_table, aes(y=ELM_type, fill=ELM_type)) + geom_bar(width = 0.5) +
  xlab("PPI number") + ylab("ELM category") + 
  theme_classic() + scale_fill_manual(values=colors_ELMtypes[c(1:4,6)]) + labs(fill = "ELM category") +
  theme(text = element_text(size = 20), legend.position = "none",  axis.text = element_text(color = "black"), 
        axis.ticks = element_line(linewidth = 1), axis.text.x = element_text(angle = 30, vjust = 1, hjust=1))  + 
  scale_x_continuous(labels = scales::comma, limits = c(0,1000))  +
  scale_y_discrete(limits=rev, labels = rev(elm_categories[c(1:4,6)])) 
p2 +  geom_text(aes(label = ..count..), stat = "count", vjust = -1, position = position_dodge(0.9), size = 3.5)

# SAVE TIFF
tiff("Figures/Figure5_graphics/AF_high_PPIs.tiff", units="cm", width=10, height=7, res=800)
p2
dev.off()

# SAVE PDF
pdf("Figures/Figure5_graphics/AF_high_PPIs.pdf", width=4, height=3)
p2
dev.off()


```

```{r ED_Figure3_Graphic_d_DMI_AF_motif_flanks_scores}
graph_x <- "Motif flanks"
graph_y <-  "Motif\nresidue pLDDT"
colors_flanks <- c(rep("limegreen",4),"forestgreen",rep("limegreen",5))

p1 <- ggplot(Model_metrics_motif %>% filter(Motif_flanks> -5 & Motif_flanks < 5), aes(x=as.factor(Motif_flanks), y=pLDDT, color=as.factor(Motif_flanks))) + 
  geom_quasirandom(size=0.5, alpha=0.5) + geom_boxplot(color="black", na.rm = TRUE, width=0.25, alpha=0.5, outlier.alpha = 0.5) +
  ggtitle("Motif confidence") + xlab(graph_x) + ylab(graph_y) + 
  theme_classic() + scale_color_manual(values=colors_flanks) +
  theme(text = element_text(size = 20), legend.position = "none", axis.text = element_text(color = "black"))
p1

# SAVE PNG
png("Figures/SuppFig_AFmodels_graphics/Motif_flanks_pLDDT.png", units="cm", width=12, height=8, res=800)
p1
dev.off()

graph_y <-  "Motif residue RSA"
p2 <- ggplot(Model_metrics_motif %>% filter(Motif_flanks> -5 & Motif_flanks < 5), aes(x=as.factor(Motif_flanks), y=SC_norm_Acc, color=as.factor(Motif_flanks))) + 
  geom_quasirandom(size=0.5, alpha=0.5) + geom_boxplot(color="black", na.rm = TRUE, width=0.25, alpha=0.5, outlier.alpha = 0.5) +
  ggtitle("Motif flank RSA") + xlab(graph_x) + ylab(graph_y) + 
  theme_classic() + scale_color_manual(values=colors_flanks) +
  theme(text = element_text(size = 20), legend.position = "none", axis.text = element_text(color = "black"))+
  scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) 
p2

# SAVE PNG
png("Figures/SuppFig_AFmodels_graphics/Motif_flanks_RSA.png", units="cm", width=12, height=8, res=800)
p2
dev.off()

graph_y <-  "Motif\nresidue \u0394 RSA"
p3 <-ggplot(Model_metrics_motif %>% filter(Motif_flanks> -5 & Motif_flanks < 5), aes(x=as.factor(Motif_flanks), y=Acc_change, color=as.factor(Motif_flanks))) + 
  geom_quasirandom(size=0.5, alpha=0.5) + geom_boxplot(color="black", na.rm = TRUE, width=0.25, alpha=0.5, outlier.alpha = 0.5) +
  ggtitle("Motif flank \u0394 RSA") + xlab(graph_x) + ylab(graph_y) + 
  theme_classic() + scale_color_manual(values=colors_flanks) +
  theme(text = element_text(size = 20), legend.position = "none", axis.text = element_text(color = "black")) +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) 
p3

# SAVE PNG
png("Figures/SuppFig_AFmodels_graphics/Motif_flanks_deltaRSA.png", units="cm", width=12, height=8, res=800)
p3
dev.off()


ggplot(Model_metrics_motif %>% filter(Motif_flanks> -5 & Motif_flanks < 5 & ELM_class=="TRG_NLS_MonoCore_2" ), aes(x=as.factor(Motif_flanks), y=Acc_change, color=as.factor(Motif_flanks))) + 
  geom_quasirandom(size=0.5, alpha=0.5) + geom_boxplot(color="black", na.rm = TRUE, width=0.25, alpha=0.5, outlier.alpha = 0.5) +
  ggtitle("Motif flank \u0394 RSA") + xlab(graph_x) + ylab(graph_y) + 
  theme_classic() + scale_color_manual(values=colors_flanks) +
  theme(text = element_text(size = 20), legend.position = "none", axis.text = element_text(color = "black"))

Model_metrics_motif %>% filter(Motif_flanks> -5 & Motif_flanks < 5 & ELM_type=="TRG") %>% select(ELM_class) %>% unique() %>% unlist()
```


```{r Legends}
p_legend <- ggplot(ClinVar_mut_dis %>% filter(!is.na(AM_pathogenicity)), aes(y=AM_pathogenicity, fill=AM_pathogenicity)) +
  geom_bar(color="black", line.width = 0.1) + labs(fill = "AlphaMissense") + 
  scale_fill_manual(values = colors_Var)+theme_minimal() +
  theme(legend.key.height= unit(1, 'cm'), legend.key.width= unit(1, 'cm'), 
        legend.title = element_text(size=35, hjust=0), legend.text = element_text(size=30))
p_legend

```